<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Kyest.cl ‚Äî BI Dashboard</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
<style>
:root{
  --bg:#070B14;--surface:#0F1629;--surface2:#162040;--border:#1E2D4F;
  --accent:#3B82F6;--accent2:#8B5CF6;--accent3:#10B981;--accent4:#F59E0B;
  --danger:#EF4444;--text:#F1F5F9;--text2:#94A3B8;--text3:#64748B;
  --sidebar:240px;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;font-size:14px}
a{color:var(--accent);text-decoration:none}
/* LAYOUT */
#app{display:flex;height:100vh;overflow:hidden}
/* SIDEBAR */
#sidebar{
  width:var(--sidebar);min-width:var(--sidebar);height:100vh;
  background:var(--surface);border-right:1px solid var(--border);
  display:flex;flex-direction:column;overflow:hidden;
  transition:width .25s,min-width .25s;
  position:relative;z-index:100;
}
#sidebar.collapsed{width:64px;min-width:64px}
#sidebar-header{
  display:flex;align-items:center;padding:20px 16px 16px;
  border-bottom:1px solid var(--border);gap:10px;
}
#logo-text{font-size:18px;font-weight:700;color:var(--accent);white-space:nowrap;overflow:hidden}
#sidebar.collapsed #logo-text{display:none}
#toggle-sidebar{
  background:none;border:none;color:var(--text2);cursor:pointer;
  font-size:18px;padding:4px;margin-left:auto;flex-shrink:0;
}
#sidebar.collapsed #toggle-sidebar{margin-left:0}
.nav-item{
  display:flex;align-items:center;gap:12px;
  padding:12px 16px;cursor:pointer;
  color:var(--text2);transition:all .2s;
  border-left:3px solid transparent;
  white-space:nowrap;overflow:hidden;
}
.nav-item:hover{background:var(--surface2);color:var(--text)}
.nav-item.active{
  background:rgba(59,130,246,.1);color:var(--accent);
  border-left-color:var(--accent);
}
.nav-icon{font-size:18px;flex-shrink:0;width:24px;text-align:center}
.nav-label{transition:opacity .2s}
#sidebar.collapsed .nav-label{opacity:0;width:0;overflow:hidden}
/* MAIN */
#main{flex:1;display:flex;flex-direction:column;overflow:hidden}
/* HEADER */
#header{
  background:var(--surface);border-bottom:1px solid var(--border);
  padding:12px 20px;display:flex;align-items:center;gap:12px;
  flex-wrap:wrap;
}
#header-title{font-size:16px;font-weight:600;flex:1}
.date-presets{display:flex;gap:4px;flex-wrap:wrap}
.preset-btn{
  background:var(--surface2);border:1px solid var(--border);
  color:var(--text2);padding:5px 10px;border-radius:6px;cursor:pointer;
  font-size:12px;transition:all .2s;
}
.preset-btn:hover,.preset-btn.active{
  background:var(--accent);border-color:var(--accent);color:#fff;
}
#date-range-input{
  background:var(--surface2);border:1px solid var(--border);
  color:var(--text);padding:6px 10px;border-radius:6px;
  font-size:12px;cursor:pointer;min-width:200px;
}
/* CONTENT */
#content{flex:1;overflow-y:auto;padding:20px}
.section{display:none}
.section.active{display:block}
/* KPI CARDS */
.kpi-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-bottom:20px}
.kpi-card{
  background:var(--surface);border:1px solid var(--border);
  border-radius:10px;padding:16px;
  transition:transform .2s,box-shadow .2s;
}
.kpi-card:hover{transform:translateY(-2px);box-shadow:0 4px 20px rgba(0,0,0,.3)}
.kpi-label{color:var(--text2);font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px}
.kpi-value{font-size:22px;font-weight:700;color:var(--text)}
.kpi-sub{font-size:11px;color:var(--text3);margin-top:4px}
.kpi-icon{font-size:24px;float:right;margin-top:-4px}
/* CHARTS */
.charts-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:16px;margin-bottom:20px}
.chart-card{
  background:var(--surface);border:1px solid var(--border);
  border-radius:10px;padding:16px;
}
.chart-title{font-size:13px;font-weight:600;color:var(--text2);margin-bottom:14px;text-transform:uppercase;letter-spacing:.4px}
.chart-wrap{position:relative}
/* TABLES */
.table-wrap{overflow-x:auto;border-radius:10px;border:1px solid var(--border)}
table{width:100%;border-collapse:collapse;background:var(--surface)}
thead{background:var(--surface2)}
th{
  padding:10px 12px;text-align:left;color:var(--text2);
  font-size:11px;font-weight:600;text-transform:uppercase;
  letter-spacing:.4px;cursor:pointer;white-space:nowrap;
  user-select:none;border-bottom:1px solid var(--border);
}
th:hover{color:var(--text);background:rgba(255,255,255,.03)}
th .sort-arrow{margin-left:4px;opacity:.4}
th.sorted .sort-arrow{opacity:1;color:var(--accent)}
td{
  padding:9px 12px;border-bottom:1px solid var(--border);
  color:var(--text);font-size:13px;white-space:nowrap;
}
tr:last-child td{border-bottom:none}
tr:hover td{background:rgba(255,255,255,.02)}
/* BADGES */
.badge{display:inline-block;padding:2px 8px;border-radius:12px;font-size:11px;font-weight:600}
.badge-green{background:rgba(16,185,129,.15);color:#10B981}
.badge-gray{background:rgba(100,116,139,.15);color:#94A3B8}
.badge-red{background:rgba(239,68,68,.15);color:#EF4444}
.badge-yellow{background:rgba(245,158,11,.15);color:#F59E0B}
.badge-blue{background:rgba(59,130,246,.15);color:#3B82F6}
/* COLORS */
.text-green{color:#10B981}
.text-yellow{color:#F59E0B}
.text-red{color:#EF4444}
.text-blue{color:#3B82F6}
.text-purple{color:#8B5CF6}
/* ALERT */
.pixel-alert{
  background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.4);
  border-radius:10px;padding:14px 18px;margin-bottom:16px;
  display:flex;align-items:center;gap:10px;flex-wrap:wrap;
}
.pixel-alert-icon{font-size:22px}
.pixel-alert-text{flex:1}
.pixel-alert-title{font-weight:700;color:#EF4444;margin-bottom:2px}
.pixel-alert-sub{color:var(--text2);font-size:12px}
/* SECTION HEADER */
.section-header{display:flex;align-items:center;gap:12px;margin-bottom:16px;flex-wrap:wrap}
.section-title{font-size:18px;font-weight:700}
.section-sub{color:var(--text2);font-size:12px;margin-left:auto}
/* SUBTABS */
.subtabs{display:flex;gap:2px;margin-bottom:16px;background:var(--surface2);padding:4px;border-radius:8px;width:fit-content}
.subtab{padding:6px 16px;border-radius:6px;cursor:pointer;color:var(--text2);font-size:13px;transition:all .2s}
.subtab.active{background:var(--accent);color:#fff;font-weight:600}
/* FUNNEL */
.funnel-wrap{padding:8px 0}
.funnel-row{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.funnel-label{width:120px;color:var(--text2);font-size:12px;text-align:right}
.funnel-bar-wrap{flex:1;background:var(--surface2);border-radius:4px;height:28px;overflow:hidden}
.funnel-bar{height:100%;border-radius:4px;display:flex;align-items:center;padding:0 10px;font-size:12px;font-weight:600;color:#fff;white-space:nowrap;transition:width .5s}
.funnel-val{width:80px;color:var(--text);font-size:12px;font-weight:600}
/* DEVICE CARDS */
.device-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:20px}
.device-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:16px}
.device-name{font-size:20px;font-weight:700;margin-bottom:10px}
.device-stat{display:flex;justify-content:space-between;margin-bottom:4px}
.device-stat-label{color:var(--text2);font-size:12px}
.device-stat-value{font-weight:600;font-size:12px}
/* SEARCH BAR */
.table-toolbar{display:flex;align-items:center;gap:10px;margin-bottom:12px;flex-wrap:wrap}
.search-input{
  background:var(--surface2);border:1px solid var(--border);
  color:var(--text);padding:7px 12px;border-radius:6px;
  font-size:13px;outline:none;flex:1;min-width:200px;
}
.search-input::placeholder{color:var(--text3)}
.search-input:focus{border-color:var(--accent)}
.export-btn{
  background:var(--surface2);border:1px solid var(--border);
  color:var(--text2);padding:7px 14px;border-radius:6px;
  cursor:pointer;font-size:12px;transition:all .2s;white-space:nowrap;
}
.export-btn:hover{background:var(--accent);border-color:var(--accent);color:#fff}
/* INSIGHT BOX */
.insight-box{
  background:var(--surface2);border-left:3px solid var(--accent);
  border-radius:0 8px 8px 0;padding:12px 16px;margin-bottom:12px;
}
.insight-title{font-weight:600;color:var(--accent);margin-bottom:4px;font-size:13px}
.insight-text{color:var(--text2);font-size:12px;line-height:1.5}
/* DONUT wrap */
.donut-wrap{max-width:300px;margin:0 auto}
/* MOBILE */
@media(max-width:768px){
  #sidebar{position:fixed;left:0;top:0;height:100vh;z-index:200;transform:translateX(-100%);transition:transform .25s}
  #sidebar.mobile-open{transform:translateX(0)}
  #sidebar.collapsed{width:var(--sidebar);min-width:var(--sidebar)}
  #overlay{display:block!important}
  .charts-grid{grid-template-columns:1fr}
  .kpi-grid{grid-template-columns:repeat(2,1fr)}
}
#overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:150}
#hamburger{display:none;background:none;border:none;color:var(--text);font-size:22px;cursor:pointer;padding:4px}
@media(max-width:768px){#hamburger{display:block}}
/* SCROLLBAR */
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:var(--surface)}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
/* CTR coloring */
.ctr-high{color:#10B981}
.ctr-mid{color:#F59E0B}
.ctr-low{color:#EF4444}
/* Progress bar mini */
.mini-bar-wrap{background:var(--surface2);border-radius:3px;height:4px;margin-top:4px;overflow:hidden}
.mini-bar{height:100%;border-radius:3px;background:var(--accent)}
</style>
</head>
<body>
<div id="overlay" onclick="toggleSidebar()"></div>
<div id="app">
<!-- SIDEBAR -->
<nav id="sidebar">
  <div id="sidebar-header">
    <span style="font-size:22px">üíé</span>
    <span id="logo-text">Kyest.cl</span>
    <button id="toggle-sidebar" onclick="toggleSidebar()" title="Colapsar">‚ò∞</button>
  </div>
  <div style="padding:12px 8px;flex:1">
    <div class="nav-item active" onclick="showSection('overview',this)">
      <span class="nav-icon">üìä</span><span class="nav-label">Overview</span>
    </div>
    <div class="nav-item" onclick="showSection('meta',this)">
      <span class="nav-icon">üì£</span><span class="nav-label">Meta Ads</span>
    </div>
    <div class="nav-item" onclick="showSection('anuncios',this)">
      <span class="nav-icon">üëÅÔ∏è</span><span class="nav-label">Anuncios</span>
    </div>
    <div class="nav-item" onclick="showSection('shopify',this)">
      <span class="nav-icon">üõí</span><span class="nav-label">Shopify</span>
    </div>
    <div class="nav-item" onclick="showSection('analytics',this)">
      <span class="nav-icon">üìà</span><span class="nav-label">Analytics</span>
    </div>
  </div>
  <div style="padding:16px;border-top:1px solid var(--border);color:var(--text3);font-size:11px">
    <span id="logo-text">Actualizado: 23/02/2026 19:48</span>
  </div>
</nav>
<!-- MAIN -->
<div id="main">
  <!-- HEADER -->
  <div id="header">
    <button id="hamburger" onclick="toggleMobile()">‚ò∞</button>
    <span id="header-title">Kyest.cl ‚Äî Panel de Control</span>
    <div class="date-presets">
      <button class="preset-btn" onclick="setPreset('today')">HOY</button>
      <button class="preset-btn" onclick="setPreset('7d')">7D</button>
      <button class="preset-btn" onclick="setPreset('30d')">30D</button>
      <button class="preset-btn" onclick="setPreset('3m')">3M</button>
      <button class="preset-btn active" onclick="setPreset('6m')">6M</button>
      <button class="preset-btn" onclick="setPreset('all')">TODO</button>
    </div>
    <input type="text" id="date-range-input" placeholder="Seleccionar fechas...">
  </div>
  <!-- CONTENT -->
  <div id="content">
    <!-- ‚ïê‚ïê‚ïê OVERVIEW ‚ïê‚ïê‚ïê -->
    <div id="section-overview" class="section active">
      <div class="section-header">
        <span class="section-title">üìä Overview General</span>
        <span class="section-sub" id="overview-range-label"></span>
      </div>
      <div class="kpi-grid" id="overview-kpis">
        <div class="kpi-card">
          <div class="kpi-icon">üí∞</div>
          <div class="kpi-label">Revenue Total</div>
          <div class="kpi-value" id="ov-revenue">‚Äî</div>
          <div class="kpi-sub" id="ov-revenue-sub">6 meses</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-icon">üì¶</div>
          <div class="kpi-label">√ìrdenes</div>
          <div class="kpi-value" id="ov-orders">‚Äî</div>
          <div class="kpi-sub" id="ov-orders-sub">Total per√≠odo</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-icon">üéØ</div>
          <div class="kpi-label">AOV</div>
          <div class="kpi-value" id="ov-aov">‚Äî</div>
          <div class="kpi-sub">Ticket Promedio</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-icon">üì£</div>
          <div class="kpi-label">Gasto Meta</div>
          <div class="kpi-value" id="ov-spend">‚Äî</div>
          <div class="kpi-sub">Inversi√≥n publicitaria</div>
        </div>
        <div class="kpi-card" id="ov-roas-card">
          <div class="kpi-icon">üìâ</div>
          <div class="kpi-label">ROAS Real</div>
          <div class="kpi-value" id="ov-roas">‚Äî</div>
          <div class="kpi-sub">Revenue / Spend</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-icon">‚úÖ</div>
          <div class="kpi-label">Ganancia Neta</div>
          <div class="kpi-value" id="ov-net">‚Äî</div>
          <div class="kpi-sub">Revenue ‚àí Gasto Meta</div>
        </div>
      </div>
      <!-- Revenue vs Gasto chart -->
      <div class="charts-grid">
        <div class="chart-card" style="grid-column:1/-1">
          <div class="chart-title">üíπ Revenue Shopify vs Gasto Meta ‚Äî Diario</div>
          <div class="chart-wrap" style="height:260px"><canvas id="chart-rev-spend"></canvas></div>
        </div>
      </div>
      <div class="charts-grid">
        <div class="chart-card">
          <div class="chart-title">üîΩ Embudo de Conversi√≥n Meta</div>
          <div id="funnel-wrap" class="funnel-wrap"></div>
        </div>
        <div class="chart-card">
          <div class="chart-title">üìà ROAS por Mes</div>
          <div class="chart-wrap" style="height:200px"><canvas id="chart-roas-trend"></canvas></div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê META ADS ‚ïê‚ïê‚ïê -->
    <div id="section-meta" class="section">
      <div class="section-header">
        <span class="section-title">üì£ Meta Ads ‚Äî Campa√±as</span>
      </div>
      <!-- KPI Strip -->
      <div class="kpi-grid" style="grid-template-columns:repeat(auto-fit,minmax(130px,1fr))">
        <div class="kpi-card">
          <div class="kpi-label">Spend Total</div>
          <div class="kpi-value text-yellow" id="m-spend">‚Äî</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">Impresiones</div>
          <div class="kpi-value" id="m-imp">‚Äî</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">Clicks</div>
          <div class="kpi-value text-blue" id="m-clicks">‚Äî</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">CTR Prom.</div>
          <div class="kpi-value" id="m-ctr">‚Äî</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">CPC Prom.</div>
          <div class="kpi-value" id="m-cpc">‚Äî</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">CPM Prom.</div>
          <div class="kpi-value" id="m-cpm">‚Äî</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">Alcance</div>
          <div class="kpi-value text-purple" id="m-reach">‚Äî</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">Mensajes</div>
          <div class="kpi-value text-green" id="m-msg">‚Äî</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">Compras Pixel</div>
          <div class="kpi-value text-red" id="m-purch">‚Äî</div>
        </div>
      </div>
      <!-- Pixel Alert -->
      <div class="pixel-alert" id="pixel-alert">
        <span class="pixel-alert-icon">‚ö†Ô∏è</span>
        <div class="pixel-alert-text">
          <div class="pixel-alert-title" id="pixel-alert-title">‚ö†Ô∏è PIXEL ROTO</div>
          <div class="pixel-alert-sub" id="pixel-alert-sub">Cargando datos...</div>
        </div>
      </div>
      <!-- Meta Monthly Chart -->
      <div class="chart-card" style="margin-bottom:16px">
        <div class="chart-title">üìÖ Gasto Meta por Mes + Clicks</div>
        <div class="chart-wrap" style="height:200px"><canvas id="chart-meta-monthly"></canvas></div>
      </div>
      <!-- Campaign Table -->
      <div class="table-toolbar">
        <span style="font-weight:600;font-size:13px">Campa√±as (10)</span>
        <span style="flex:1"></span>
        <button class="export-btn" onclick="exportCSV('campaign-table','kyest_campaigns.csv')">‚¨á Exportar CSV</button>
      </div>
      <div class="table-wrap">
        <table id="campaign-table">
          <thead>
            <tr>
              <th onclick="sortTable('campaign-table',0)" data-col="0">Campa√±a <span class="sort-arrow">‚Üï</span></th>
              <th onclick="sortTable('campaign-table',1)" data-col="1">Objetivo <span class="sort-arrow">‚Üï</span></th>
              <th onclick="sortTable('campaign-table',2)" data-col="2">Estado <span class="sort-arrow">‚Üï</span></th>
              <th onclick="sortTable('campaign-table',3)" data-col="3">Gasto <span class="sort-arrow">‚Üï</span></th>
              <th onclick="sortTable('campaign-table',4)" data-col="4">Impres. <span class="sort-arrow">‚Üï</span></th>
              <th onclick="sortTable('campaign-table',5)" data-col="5">Clicks <span class="sort-arrow">‚Üï</span></th>
              <th onclick="sortTable('campaign-table',6)" data-col="6">CTR <span class="sort-arrow">‚Üï</span></th>
              <th onclick="sortTable('campaign-table',7)" data-col="7">CPC <span class="sort-arrow">‚Üï</span></th>
              <th onclick="sortTable('campaign-table',8)" data-col="8">CPM <span class="sort-arrow">‚Üï</span></th>
              <th onclick="sortTable('campaign-table',9)" data-col="9">Alcance <span class="sort-arrow">‚Üï</span></th>
              <th onclick="sortTable('campaign-table',10)" data-col="10">Mensajes <span class="sort-arrow">‚Üï</span></th>
              <th onclick="sortTable('campaign-table',11)" data-col="11">Carrito <span class="sort-arrow">‚Üï</span></th>
              <th onclick="sortTable('campaign-table',12)" data-col="12">Compras <span class="sort-arrow">‚Üï</span></th>
              <th onclick="sortTable('campaign-table',13)" data-col="13">Costo/Res. <span class="sort-arrow">‚Üï</span></th>
            </tr>
          </thead>
          <tbody id="campaign-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê META CAMPAIGN CHARTS ‚ïê‚ïê‚ïê -->
      <div class="charts-grid" style="margin-top:16px">
        <div class="chart-card">
          <div class="chart-title">üí∏ Top 10 Campa√±as por Gasto</div>
          <div class="chart-wrap" style="height:240px"><canvas id="chart-camp-spend"></canvas></div>
        </div>
        <div class="chart-card">
          <div class="chart-title">üìä CTR por Campa√±a (Top 10)</div>
          <div class="chart-wrap" style="height:240px"><canvas id="chart-camp-ctr"></canvas></div>
        </div>
      </div>
    <!-- ‚ïê‚ïê‚ïê ANUNCIOS ‚ïê‚ïê‚ïê -->
    <div id="section-anuncios" class="section">
      <div class="section-header">
        <span class="section-title">üëÅÔ∏è Nivel Anuncios</span>
      </div>
      <div class="subtabs">
        <div class="subtab active" onclick="showSubtab('ads',this)">Anuncios</div>
        <div class="subtab" onclick="showSubtab('adsets',this)">Ad Sets</div>
      </div>
      <!-- Ads sub-panel -->
      <div id="panel-ads">
        <div class="table-toolbar">
          <input type="text" class="search-input" id="ads-search" placeholder="üîç Buscar anuncio..." oninput="filterAdsTable()">
          <button class="export-btn" onclick="exportCSV('ads-table','kyest_ads.csv')">‚¨á Exportar CSV</button>
        </div>
        <div class="table-wrap">
          <table id="ads-table">
            <thead>
              <tr>
                <th onclick="sortTable('ads-table',0)">Anuncio <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('ads-table',1)">Ad Set <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('ads-table',2)">Campa√±a <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('ads-table',3)">Gasto <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('ads-table',4)">Impres. <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('ads-table',5)">Clicks <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('ads-table',6)">CTR <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('ads-table',7)">CPC <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('ads-table',8)">CPM <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('ads-table',9)">Alcance <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('ads-table',10)">Resultados <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('ads-table',11)">Costo/Res. <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('ads-table',12)">Engagement <span class="sort-arrow">‚Üï</span></th>
              </tr>
            </thead>
            <tbody id="ads-tbody"></tbody>
          </table>
        </div>
      </div>
      <!-- Adsets sub-panel -->
      <div id="panel-adsets" style="display:none">
        <div class="table-toolbar">
          <button class="export-btn" onclick="exportCSV('adsets-table','kyest_adsets.csv')">‚¨á Exportar CSV</button>
        </div>
        <div class="table-wrap">
          <table id="adsets-table">
            <thead>
              <tr>
                <th onclick="sortTable('adsets-table',0)">Ad Set <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('adsets-table',1)">Campa√±a <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('adsets-table',2)">Gasto <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('adsets-table',3)">Impres. <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('adsets-table',4)">Clicks <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('adsets-table',5)">CTR <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('adsets-table',6)">CPC <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('adsets-table',7)">Mensajes <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('adsets-table',8)">Compras <span class="sort-arrow">‚Üï</span></th>
              </tr>
            </thead>
            <tbody id="adsets-tbody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê SHOPIFY ‚ïê‚ïê‚ïê -->
    <div id="section-shopify" class="section">
      <div class="section-header">
        <span class="section-title">üõí Shopify Analytics</span>
      </div>
      <!-- KPI Strip -->
      <div class="kpi-grid">
        <div class="kpi-card">
          <div class="kpi-icon">üí∞</div>
          <div class="kpi-label">Revenue</div>
          <div class="kpi-value text-green" id="sh-rev">‚Äî</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-icon">üì¶</div>
          <div class="kpi-label">√ìrdenes</div>
          <div class="kpi-value" id="sh-ord">‚Äî</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-icon">üéØ</div>
          <div class="kpi-label">AOV</div>
          <div class="kpi-value" id="sh-aov">‚Äî</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-icon">üÜï</div>
          <div class="kpi-label">Clientes Nuevos</div>
          <div class="kpi-value text-blue" id="sh-new">‚Äî</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-icon">üîÑ</div>
          <div class="kpi-label">Clientes Repetidores</div>
          <div class="kpi-value text-purple" id="sh-rep">‚Äî</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-icon">üìä</div>
          <div class="kpi-label">Tasa Retenci√≥n</div>
          <div class="kpi-value" id="sh-ret">‚Äî</div>
        </div>
      </div>
      <!-- Charts -->
      <div class="charts-grid">
        <div class="chart-card">
          <div class="chart-title">üìÖ Revenue Mensual + √ìrdenes</div>
          <div class="chart-wrap" style="height:220px"><canvas id="chart-monthly-rev"></canvas></div>
        </div>
        <div class="chart-card">
          <div class="chart-title">üë• Nuevos vs Repetidores por Mes</div>
          <div class="chart-wrap" style="height:220px"><canvas id="chart-cust-type"></canvas></div>
        </div>
      </div>
      <div class="charts-grid">
        <div class="chart-card" style="grid-column:1/-1">
          <div class="chart-title">üèÜ Top 10 Productos por Revenue</div>
          <div class="chart-wrap" style="height:280px"><canvas id="chart-products"></canvas></div>
        </div>
      </div>
      <div class="charts-grid">
        <div class="chart-card">
          <div class="chart-title">üí≥ Estado Financiero</div>
          <div class="donut-wrap" style="height:200px"><canvas id="chart-fin-status"></canvas></div>
        </div>
        <div class="chart-card">
          <div class="chart-title">üóí √ìrdenes Recientes (√∫ltimas 20)</div>
          <div class="table-wrap" style="max-height:240px;overflow-y:auto">
            <table id="orders-table">
              <thead>
                <tr>
                  <th>Orden</th><th>Fecha</th><th>Cliente</th>
                  <th>Total</th><th>Pago</th><th>Env√≠o</th><th>Items</th>
                </tr>
              </thead>
              <tbody id="orders-tbody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê ANALYTICS ‚ïê‚ïê‚ïê -->
    <div id="section-analytics" class="section">
      <div class="section-header">
        <span class="section-title">üìà Google Analytics 4</span>
        <span class="section-sub">√öltimos 6 meses ¬∑ Propiedad kyest.cl</span>
      </div>
      <!-- Insight boxes -->
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:12px;margin-bottom:16px">
        <div class="insight-box">
          <div class="insight-title">üèÜ Mejor Tasa de Conversi√≥n: Directo</div>
          <div class="insight-text">25 conversiones de 1.089 sesiones = <strong style="color:#10B981">2.3% conv. rate</strong>. El tr√°fico directo convierte 10√ó mejor que Paid Social.</div>
        </div>
        <div class="insight-box" style="border-left-color:var(--danger)">
          <div class="insight-title" style="color:var(--danger)">‚ö†Ô∏è Paid Social: 75% Bounce Rate</div>
          <div class="insight-text">Alta inversi√≥n en Meta Ads con <strong style="color:#EF4444">75.3% de rebote</strong>. Oportunidad de mejora en landing pages y targeting.</div>
        </div>
        <div class="insight-box" style="border-left-color:var(--accent3)">
          <div class="insight-title" style="color:var(--accent3)">‚è±Ô∏è Mejor Tiempo en Sitio: Org√°nico</div>
          <div class="insight-text">Organic Search: <strong style="color:#10B981">239 segundos</strong> promedio vs 84s de Paid Social. Contenido org√°nico engancha m√°s.</div>
        </div>
      </div>
      <!-- Channels table -->
      <div style="margin-bottom:16px">
        <div style="font-weight:600;margin-bottom:10px;color:var(--text2)">CANALES DE TR√ÅFICO ‚Äî 6 MESES</div>
        <div class="table-wrap">
          <table id="ga4-table">
            <thead>
              <tr>
                <th onclick="sortTable('ga4-table',0)">Canal <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('ga4-table',1)">Sesiones <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('ga4-table',2)">Usuarios <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('ga4-table',3)">Nuevos <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('ga4-table',4)">Conv. <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('ga4-table',5)">Revenue <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('ga4-table',6)">Bounce % <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('ga4-table',7)">Duraci√≥n <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('ga4-table',8)">Conv Rate <span class="sort-arrow">‚Üï</span></th>
              </tr>
            </thead>
            <tbody id="ga4-tbody"></tbody>
          </table>
        </div>
      </div>
      <!-- Device cards -->
      <div style="font-weight:600;margin-bottom:10px;color:var(--text2)">POR DISPOSITIVO</div>
      <div class="device-grid" id="device-grid"></div>
      <!-- Monthly chart -->
      <div class="chart-card">
        <div class="chart-title">üìÖ Tendencia Mensual ‚Äî Sesiones & Conversiones</div>
        <div class="chart-wrap" style="height:200px"><canvas id="chart-ga4-monthly"></canvas></div>
      </div>
    </div>
  </div><!-- /content -->
</div><!-- /main -->
</div><!-- /app -->

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const RAW = {"total_revenue": 43603226.0, "total_orders": 250, "aov": 174412.904, "repeat_rate": 0.18811881188118812, "repeat_customers": 38, "total_unique_customers": 202, "meta_spend": 25076610.0, "real_roas": 1.7388006592597645, "net_profit": 18526616.0, "pixel_roas": 2.8446778785489744, "pixel_purchases": 409, "meta_totals": {"spend": 25076610.0, "impressions": 10408204, "clicks": 279442, "reach": 1704172, "messages": 2410, "purchases": 409, "avg_ctr": 2.367144625, "avg_cpc": 172.62455133333333, "avg_cpm": 2552.3553455833335, "pixel_purchases": 409}, "daily_data": [{"date": "2025-08-23", "revenue": 355090.0}, {"date": "2025-08-25", "revenue": 2216900.0}, {"date": "2025-08-26", "revenue": 3851130.0}, {"date": "2025-08-27", "revenue": 1441281.0}, {"date": "2025-08-28", "revenue": 1327180.0}, {"date": "2025-08-29", "revenue": 3424950.0}, {"date": "2025-08-30", "revenue": 1919800.0}, {"date": "2025-08-31", "revenue": 292920.0}, {"date": "2025-09-01", "revenue": 621490.0}, {"date": "2025-09-02", "revenue": 616000.0}, {"date": "2025-09-04", "revenue": 1491400.0}, {"date": "2025-09-05", "revenue": 2319025.0}, {"date": "2025-09-06", "revenue": 2152200.0}, {"date": "2025-09-08", "revenue": 1622570.0}, {"date": "2025-09-09", "revenue": 3215320.0}, {"date": "2025-09-10", "revenue": 58600.0}, {"date": "2025-09-11", "revenue": 854300.0}, {"date": "2025-09-12", "revenue": 1289380.0}, {"date": "2025-09-13", "revenue": 315000.0}, {"date": "2025-09-15", "revenue": 505695.0}, {"date": "2025-09-16", "revenue": 1078400.0}, {"date": "2025-09-17", "revenue": 172000.0}, {"date": "2025-09-21", "revenue": 241800.0}, {"date": "2025-09-22", "revenue": 999700.0}, {"date": "2025-09-23", "revenue": 3245400.0}, {"date": "2025-09-24", "revenue": 2550640.0}, {"date": "2025-09-25", "revenue": 3001900.0}, {"date": "2025-09-26", "revenue": 1960630.0}, {"date": "2025-09-27", "revenue": 462525.0}], "monthly_data": [{"month": "2025-08", "revenue": 14829251.0, "orders": 87, "new": 74, "repeat": 13, "aov": 170451.16091954024}, {"month": "2025-09", "revenue": 28773975.0, "orders": 163, "new": 128, "repeat": 35, "aov": 176527.45398773006}], "meta_monthly": [{"date_start": "2025-08-23", "date_stop": "2025-08-31", "label": "2025-08", "spend": 1089585.0, "impressions": 782415, "clicks": 77871, "ctr": 9.952647, "cpc": 13.992179, "cpm": 1392.592167, "reach": 497557, "link_clicks": 73947, "add_to_cart": 76, "initiated_checkout": 18, "purchases": 11, "messages": 257, "engagement": 613378, "results": 268, "cost_per_result": 4065.615671641791, "cost_per_purchase": 99053.181818, "cost_per_link_click": 14.734675, "pixel_roas": 0}, {"date_start": "2025-09-01", "date_stop": "2025-09-30", "label": "2025-09", "spend": 3499035.0, "impressions": 2336142, "clicks": 97213, "ctr": 4.161262, "cpc": 35.993489, "cpm": 1497.783525, "reach": 564772, "link_clicks": 86371, "add_to_cart": 692, "initiated_checkout": 174, "purchases": 73, "messages": 641, "engagement": 1058797, "results": 714, "cost_per_result": 4900.609243697479, "cost_per_purchase": 47931.986301, "cost_per_link_click": 40.511688, "pixel_roas": 0}, {"date_start": "2025-10-01", "date_stop": "2025-10-31", "label": "2025-10", "spend": 4652275.0, "impressions": 1586268, "clicks": 22279, "ctr": 1.404492, "cpc": 208.818843, "cpm": 2932.843, "reach": 107073, "link_clicks": 14961, "add_to_cart": 792, "initiated_checkout": 254, "purchases": 135, "messages": 342, "engagement": 289452, "results": 477, "cost_per_result": 9753.197064989517, "cost_per_purchase": 34461.296296, "cost_per_link_click": 310.960163, "pixel_roas": 0}, {"date_start": "2025-11-01", "date_stop": "2025-11-30", "label": "2025-11", "spend": 5542535.0, "impressions": 1731151, "clicks": 25348, "ctr": 1.464228, "cpc": 218.657685, "cpm": 3201.647343, "reach": 166961, "link_clicks": 17880, "add_to_cart": 770, "initiated_checkout": 195, "purchases": 89, "messages": 223, "engagement": 379292, "results": 312, "cost_per_result": 17764.535256410258, "cost_per_purchase": 62275.674157, "cost_per_link_click": 309.985179, "pixel_roas": 0}, {"date_start": "2025-12-01", "date_stop": "2025-12-31", "label": "2025-12", "spend": 5790159.0, "impressions": 1971864, "clicks": 26986, "ctr": 1.368553, "cpc": 214.561587, "cpm": 2936.388615, "reach": 112508, "link_clicks": 21056, "add_to_cart": 458, "initiated_checkout": 116, "purchases": 74, "messages": 197, "engagement": 385147, "results": 271, "cost_per_result": 21365.90036900369, "cost_per_purchase": 78245.391892, "cost_per_link_click": 274.988554, "pixel_roas": 0}, {"date_start": "2026-01-01", "date_stop": "2026-01-31", "label": "2026-01", "spend": 2896692.0, "impressions": 1203034, "clicks": 15815, "ctr": 1.314593, "cpc": 183.16105, "cpm": 2407.822223, "reach": 109862, "link_clicks": 9348, "add_to_cart": 94, "initiated_checkout": 20, "purchases": 16, "messages": 239, "engagement": 308500, "results": 255, "cost_per_result": 11359.576470588236, "cost_per_purchase": 181043.25, "cost_per_link_click": 309.872914, "pixel_roas": 0}, {"date_start": "2026-02-01", "date_stop": "2026-02-23", "label": "2026-02", "spend": 1606654.0, "impressions": 797502, "clicks": 13937, "ctr": 1.747582, "cpc": 115.279759, "cpm": 2014.608114, "reach": 102683, "link_clicks": 6492, "add_to_cart": 144, "initiated_checkout": 23, "purchases": 11, "messages": 511, "engagement": 256715, "results": 522, "cost_per_result": 3077.8812260536397, "cost_per_purchase": 146059.454545, "cost_per_link_click": 247.482132, "pixel_roas": 0}], "financial_status": {"paid": 243, "pending": 7}, "top_products": [{"name": "Brasile√±o |Depilaci√≥n l√°ser Alexandrita Pro de Candela", "revenue": 2037600.0, "units": 11}, {"name": "Sculpt freeze Ema", "revenue": 1800000.0, "units": 1}, {"name": "Sculpt freeze abd+espalda +maf+", "revenue": 1644200.0, "units": 1}, {"name": "Sculpt Freeze Abdomen + Espalda + 6 sesiones MAF + 1 sesion UCV + Bonus Infusi√≥n Golden Milk, Guia Antinflamatoria, Historia, 1 mes Entrenamiento", "revenue": 1500000.0, "units": 1}, {"name": "Axilas |Depilaci√≥n l√°ser Alexandrita Pro de Candela", "revenue": 1444000.0, "units": 20}, {"name": "Piernas completas, Brasile√±o y Axilas| Depilaci√≥n l√°ser Alexandrita Pro de Candela", "revenue": 1440900.0, "units": 3}, {"name": "Sculpt freeze", "revenue": 1400000.0, "units": 1}, {"name": "6 sesiones MAF + Sculpt Freeze Abdomen y Espalda + Bonos", "revenue": 1400000.0, "units": 1}, {"name": "Brasile√±o y Axilas | Depilaci√≥n l√°ser Alexandrita Pro de Candela", "revenue": 1355400.0, "units": 6}, {"name": "Sculpt Freeze Abdomen + Espalda + Bonos", "revenue": 1200000.0, "units": 1}], "last_20_orders": [{"id": 6502495060220, "name": "#6502495060220", "created_at": "2025-09-27", "customer": "nilda.vergara@hotmail.com", "total_price": 112200.0, "financial_status": "paid", "fulfillment_status": "fulfilled", "items": 2}, {"id": 6502425755900, "name": "#6502425755900", "created_at": "2025-09-27", "customer": "katyta300@gmail.com", "total_price": 108900.0, "financial_status": "pending", "fulfillment_status": "unfulfilled", "items": 2}, {"id": 6502072287484, "name": "#6502072287484", "created_at": "2025-09-27", "customer": "djkathia@gmail.com", "total_price": 241425.0, "financial_status": "paid", "fulfillment_status": "fulfilled", "items": 4}, {"id": 6501874073852, "name": "#6501874073852", "created_at": "2025-09-26", "customer": "odontoauri01@gmail.com", "total_price": 112200.0, "financial_status": "paid", "fulfillment_status": "fulfilled", "items": 1}, {"id": 6501830000892, "name": "#6501830000892", "created_at": "2025-09-26", "customer": "sepulvedajessica@hotmail.cl", "total_price": 155040.0, "financial_status": "paid", "fulfillment_status": "unfulfilled", "items": 1}, {"id": 6501779669244, "name": "#6501779669244", "created_at": "2025-09-26", "customer": "jsaraviabarraza@gmail.com", "total_price": 44000.0, "financial_status": "paid", "fulfillment_status": "fulfilled", "items": 1}, {"id": 6501715607804, "name": "#6501715607804", "created_at": "2025-09-26", "customer": "Elizabeth_mgonzalez@hotmail.com", "total_price": 42800.0, "financial_status": "paid", "fulfillment_status": "fulfilled", "items": 1}, {"id": 6501596037372, "name": "#6501596037372", "created_at": "2025-09-26", "customer": "psalgado889@gmail.com", "total_price": 161310.0, "financial_status": "paid", "fulfillment_status": "fulfilled", "items": 1}, {"id": 6501528600828, "name": "#6501528600828", "created_at": "2025-09-26", "customer": "Elizabeth_mgonzalez@hotmail.com", "total_price": 432270.0, "financial_status": "paid", "fulfillment_status": "fulfilled", "items": 2}, {"id": 6501525946620, "name": "#6501525946620", "created_at": "2025-09-26", "customer": "carolinarios2005@yahoo.com", "total_price": 25000.0, "financial_status": "paid", "fulfillment_status": "fulfilled", "items": 1}, {"id": 6501524734204, "name": "#6501524734204", "created_at": "2025-09-26", "customer": "a_salinas21@hotmail.com", "total_price": 56100.0, "financial_status": "paid", "fulfillment_status": "fulfilled", "items": 1}, {"id": 6501508350204, "name": "#6501508350204", "created_at": "2025-09-26", "customer": "alexandrapueblac@gmail.com", "total_price": 56100.0, "financial_status": "paid", "fulfillment_status": "fulfilled", "items": 1}, {"id": 6501484069116, "name": "#6501484069116", "created_at": "2025-09-26", "customer": "amildrejorquera16@gmail.com", "total_price": 28000.0, "financial_status": "paid", "fulfillment_status": "fulfilled", "items": 1}, {"id": 6501482430716, "name": "#6501482430716", "created_at": "2025-09-26", "customer": "jonathan_perez@live.com.mx", "total_price": 125010.0, "financial_status": "paid", "fulfillment_status": "fulfilled", "items": 1}, {"id": 6501424857340, "name": "#6501424857340", "created_at": "2025-09-26", "customer": "amildrejorquera16@gmail.com", "total_price": 117700.0, "financial_status": "paid", "fulfillment_status": "fulfilled", "items": 1}, {"id": 6501423317244, "name": "#6501423317244", "created_at": "2025-09-26", "customer": "ana.sanchez@idssm.cl", "total_price": 64000.0, "financial_status": "paid", "fulfillment_status": "fulfilled", "items": 1}, {"id": 6501296341244, "name": "#6501296341244", "created_at": "2025-09-26", "customer": "m.leiva@cervantino.cl", "total_price": 50490.0, "financial_status": "paid", "fulfillment_status": "fulfilled", "items": 1}, {"id": 6501265408252, "name": "#6501265408252", "created_at": "2025-09-26", "customer": "Alpebu12@gmail.com", "total_price": 161310.0, "financial_status": "paid", "fulfillment_status": "fulfilled", "items": 1}, {"id": 6501247451388, "name": "#6501247451388", "created_at": "2025-09-26", "customer": "javierazepedanavarrete@gmail.com", "total_price": 90000.0, "financial_status": "paid", "fulfillment_status": "fulfilled", "items": 2}, {"id": 6500981276924, "name": "#6500981276924", "created_at": "2025-09-26", "customer": "Elizabethr.arancibia@gmail.com", "total_price": 25000.0, "financial_status": "paid", "fulfillment_status": "fulfilled", "items": 1}], "campaign_rows": [{"name": "2025.06.18 [4ta ITERACI√ìN] Generacion de Consultas Sculpt", "objective": "OUTCOME_LEADS", "status": "PAUSED", "spend": 7168262.0, "impressions": 2627186, "clicks": 32888, "ctr": 1.2518337110505309, "cpc": 217.95980296764776, "cpm": 2728.49429008833, "reach": 474401, "messages": 464, "add_to_cart": 226, "purchases": 73, "results": 537, "cost_per_result": 13348.71880819367}, {"name": "2025.06.Julio Campa√±a unica de depilaci√≥n Laser", "objective": "OUTCOME_ENGAGEMENT", "status": "PAUSED", "spend": 1267321.0, "impressions": 604508, "clicks": 16538, "ctr": 2.7357785174058904, "cpc": 76.63085016326038, "cpm": 2096.450336471974, "reach": 243268, "messages": 844, "add_to_cart": 16, "purchases": 3, "results": 847, "cost_per_result": 1496.2467532467533}, {"name": "Ventas  shopy depilaci√≥n l√°ser  Agosto", "objective": "OUTCOME_SALES", "status": "PAUSED", "spend": 756849.0, "impressions": 953426, "clicks": 60429, "ctr": 6.3380902136086075, "cpc": 12.524599116318324, "cpm": 793.8203908850818, "reach": 380807, "messages": 0, "add_to_cart": 34, "purchases": 0, "results": 0, "cost_per_result": 0}, {"name": "campa√±a LEADS de Interacci√≥n PARA CYBER", "objective": "OUTCOME_ENGAGEMENT", "status": "PAUSED", "spend": 597179.0, "impressions": 541730, "clicks": 20380, "ctr": 3.7620216713122776, "cpc": 29.302208047105005, "cpm": 1102.3554169051004, "reach": 208652, "messages": 11, "add_to_cart": 46, "purchases": 3, "results": 14, "cost_per_result": 42655.642857142855}, {"name": "2025.06. Ventas Julio Campa√±a unica de depilaci√≥n Laser - Copia", "objective": "OUTCOME_TRAFFIC", "status": "PAUSED", "spend": 553037.0, "impressions": 499903, "clicks": 70238, "ctr": 14.05032576319806, "cpc": 7.873757794925823, "cpm": 1106.2886199922787, "reach": 393219, "messages": 0, "add_to_cart": 12, "purchases": 0, "results": 0, "cost_per_result": 0}, {"name": "2024.12.05 Interaccion Mensajes Nueva sucursal", "objective": "UNKNOWN", "status": "UNKNOWN", "spend": 254808.0, "impressions": 136141, "clicks": 2219, "ctr": 1.6299277954473672, "cpc": 114.83010365029293, "cpm": 1871.647776937146, "reach": 32137, "messages": 144, "add_to_cart": 4, "purchases": 0, "results": 144, "cost_per_result": 1769.5}, {"name": "AON - WEB - Venta - Depilacion | React. 04.02", "objective": "OUTCOME_SALES", "status": "PAUSED", "spend": 193135.0, "impressions": 53461, "clicks": 930, "ctr": 1.7395858663324666, "cpc": 207.6720430107527, "cpm": 3612.6335085389346, "reach": 22889, "messages": 11, "add_to_cart": 54, "purchases": 9, "results": 20, "cost_per_result": 9656.75}, {"name": "Campa√±a Campa√±a de clientes potenciales para CYBER  13/9/2025 Campa√±a", "objective": "OUTCOME_LEADS", "status": "PAUSED", "spend": 27883.0, "impressions": 12271, "clicks": 206, "ctr": 1.6787547877108628, "cpc": 135.35436893203882, "cpm": 2272.2679488224267, "reach": 4129, "messages": 6, "add_to_cart": 0, "purchases": 0, "results": 6, "cost_per_result": 4647.166666666667}, {"name": "2025.04.11 [2da ITERACI√ìN] Generacion de Consultas Sculpt Freeze", "objective": "OUTCOME_LEADS", "status": "PAUSED", "spend": 7306.0, "impressions": 3061, "clicks": 21, "ctr": 0.6860503103560928, "cpc": 347.9047619047619, "cpm": 2386.8016987912447, "reach": 2017, "messages": 0, "add_to_cart": 0, "purchases": 0, "results": 0, "cost_per_result": 0}, {"name": "CBO KYEST DEPILACION LASER mujer cyber ok", "objective": "OUTCOME_SALES", "status": "PAUSED", "spend": 7272.0, "impressions": 1926, "clicks": 32, "ctr": 1.6614745586708204, "cpc": 227.25, "cpm": 3775.700934579439, "reach": 1294, "messages": 2, "add_to_cart": 6, "purchases": 1, "results": 3, "cost_per_result": 2424.0}], "adset_rows": [{"name": "2025.05.15 TT (SAN FELIPE) Segmentacion detallada advantage + RRSS, WEB y BBDD - Copia 2", "campaign": "2025.06.18 [4ta ITERACI√ìN] Generacion de Consultas Sculpt", "spend": 3066756.0, "impressions": 1155448, "clicks": 15279, "ctr": 1.322344233578664, "cpc": 200.7170626349892, "cpm": 2654.170503562255, "reach": 121749, "messages": 308, "purchases": 38, "results": 346, "cost_per_result": 8863.456647398843}, {"name": "2025.06.18 TT (Los ANDES) Segmentacion detallada advantage + RRSS, WEB y BBDD", "campaign": "2025.06.18 [4ta ITERACI√ìN] Generacion de Consultas Sculpt", "spend": 2424172.0, "impressions": 828969, "clicks": 8184, "ctr": 0.9872504279412136, "cpc": 296.20869990224827, "cpm": 2924.3216573840514, "reach": 213628, "messages": 45, "purchases": 6, "results": 51, "cost_per_result": 47532.78431372549}, {"name": "2025.05.15 TT (SAN FELIPE) Segmentacion detallada advantage + RRSS, WEB y BBDD - Copia", "campaign": "2025.06.18 [4ta ITERACI√ìN] Generacion de Consultas Sculpt", "spend": 1591219.0, "impressions": 592374, "clicks": 7646, "ctr": 1.2907386212088985, "cpc": 208.11130002615747, "cpm": 2686.172924537539, "reach": 96913, "messages": 108, "purchases": 28, "results": 136, "cost_per_result": 11700.139705882353}, {"name": "Winners videos", "campaign": "2025.06. Ventas Julio Campa√±a unica de depilaci√≥n Laser - Copia", "spend": 858163.0, "impressions": 645840, "clicks": 71903, "ctr": 11.133252818035427, "cpc": 11.935009665799758, "cpm": 1328.754799950452, "reach": 422765, "messages": 136, "purchases": 3, "results": 139, "cost_per_result": 6173.8345323741005}, {"name": "winners organicos", "campaign": "2025.06.Julio Campa√±a unica de depilaci√≥n Laser", "spend": 554507.0, "impressions": 244694, "clicks": 12403, "ctr": 5.068779782095188, "cpc": 44.70749012335725, "cpm": 2266.1242204549358, "reach": 121765, "messages": 505, "purchases": 0, "results": 505, "cost_per_result": 1098.0336633663367}, {"name": "video ads leads", "campaign": "campa√±a LEADS de Interacci√≥n PARA CYBER", "spend": 453861.0, "impressions": 457875, "clicks": 18592, "ctr": 4.060496860496861, "cpc": 24.411628657487093, "cpm": 991.2334152334153, "reach": 181936, "messages": 2, "purchases": 1, "results": 3, "cost_per_result": 151287.0}, {"name": "videos rehechos", "campaign": "2025.06.Julio Campa√±a unica de depilaci√≥n Laser", "spend": 407688.0, "impressions": 213877, "clicks": 2470, "ctr": 1.1548693875451777, "cpc": 165.05587044534414, "cpm": 1906.179720119508, "reach": 91957, "messages": 203, "purchases": 0, "results": 203, "cost_per_result": 2008.3152709359606}, {"name": "2025.08.15 CATALOGO", "campaign": "Ventas  shopy depilaci√≥n l√°ser  Agosto", "spend": 379458.0, "impressions": 607267, "clicks": 31000, "ctr": 5.104838563597232, "cpc": 12.240580645161291, "cpm": 624.8618811824124, "reach": 169724, "messages": 0, "purchases": 0, "results": 0, "cost_per_result": 0}, {"name": "winner videos  depilacion", "campaign": "Ventas  shopy depilaci√≥n l√°ser  Agosto", "spend": 376160.0, "impressions": 344390, "clicks": 29365, "ctr": 8.526670344667382, "cpc": 12.809807594074579, "cpm": 1092.2500653329075, "reach": 209338, "messages": 0, "purchases": 0, "results": 0, "cost_per_result": 0}, {"name": "2024.12.05 TT Segmentacion detallada advantage + RRSS, WEB y BBDD", "campaign": "2024.12.05 Interaccion Mensajes Nueva sucursal", "spend": 254808.0, "impressions": 136141, "clicks": 2219, "ctr": 1.6299277954473672, "cpc": 114.83010365029293, "cpm": 1871.647776937146, "reach": 32137, "messages": 144, "purchases": 0, "results": 144, "cost_per_result": 1769.5}, {"name": "Advantage Video", "campaign": "AON - WEB - Venta - Depilacion | React. 04.02", "spend": 158032.0, "impressions": 42870, "clicks": 788, "ctr": 1.8381152320970378, "cpc": 200.5482233502538, "cpm": 3686.307441101003, "reach": 17497, "messages": 11, "purchases": 7, "results": 18, "cost_per_result": 8779.555555555555}, {"name": "GRAFICAS ADS LEADS", "campaign": "campa√±a LEADS de Interacci√≥n PARA CYBER", "spend": 143318.0, "impressions": 83855, "clicks": 1788, "ctr": 2.1322521018424663, "cpc": 80.15548098434004, "cpm": 1709.116928030529, "reach": 26716, "messages": 9, "purchases": 2, "results": 11, "cost_per_result": 13028.90909090909}, {"name": "2025.25.2025 organico testimonio", "campaign": "2025.06.18 [4ta ITERACI√ìN] Generacion de Consultas Sculpt", "spend": 86115.0, "impressions": 50395, "clicks": 1779, "ctr": 3.5301121142970535, "cpc": 48.40640809443508, "cpm": 1708.800476237722, "reach": 42111, "messages": 3, "purchases": 1, "results": 4, "cost_per_result": 21528.75}, {"name": "advantage im√°genes", "campaign": "AON - WEB - Venta - Depilacion | React. 04.02", "spend": 35103.0, "impressions": 10591, "clicks": 142, "ctr": 1.3407610235105278, "cpc": 247.20422535211267, "cpm": 3314.4179019922576, "reach": 5392, "messages": 0, "purchases": 2, "results": 2, "cost_per_result": 17551.5}, {"name": "Campa√±a Campa√±a de clientes potenciales para CYBER  13/9/2025 Conjunto de anuncios", "campaign": "Campa√±a Campa√±a de clientes potenciales para CYBER  13/9/2025 Campa√±a", "spend": 27883.0, "impressions": 12271, "clicks": 206, "ctr": 1.6787547877108628, "cpc": 135.35436893203882, "cpm": 2272.2679488224267, "reach": 4129, "messages": 6, "purchases": 0, "results": 6, "cost_per_result": 4647.166666666667}], "ads_rows": [{"ad_name": "2025.05.15 Video 1 CTA Mas Informaci√≥n - Copia 2", "adset_name": "2025.05.15 TT (SAN FELIPE) Segmentacion detallada advantage + RRSS, WEB y BBDD - Copia 2", "campaign_name": "2025.06.18 [4ta ITERACI√ìN] Generacion de Consultas Sculpt", "spend": 2574008.0, "impressions": 1011064, "clicks": 13825, "ctr": 1.367371, "cpc": 186.185027, "cpm": 2545.840817, "reach": 79103, "link_clicks": 8633, "add_to_cart": 74, "initiated_checkout": 23, "purchases": 27, "messages": 278, "engagement": 280264, "results": 305, "cost_per_result": 8439.370491803278, "cost_per_purchase": 95333.62963, "cost_per_link_click": 298.159157, "pixel_roas": 0, "date_start": "2025-08-23", "date_stop": "2026-02-23"}, {"ad_name": "2025.05.15 Video 1 CTA Mas Informaci√≥n - Copia 2", "adset_name": "2025.05.15 TT (SAN FELIPE) Segmentacion detallada advantage + RRSS, WEB y BBDD - Copia", "campaign_name": "2025.06.18 [4ta ITERACI√ìN] Generacion de Consultas Sculpt", "spend": 1107095.0, "impressions": 447597, "clicks": 6111, "ctr": 1.365291, "cpc": 181.164294, "cpm": 2473.419169, "reach": 58170, "link_clicks": 3914, "add_to_cart": 82, "initiated_checkout": 17, "purchases": 20, "messages": 92, "engagement": 120801, "results": 112, "cost_per_result": 9884.776785714286, "cost_per_purchase": 55354.75, "cost_per_link_click": 282.855135, "pixel_roas": 0, "date_start": "2025-08-23", "date_stop": "2026-02-23"}, {"ad_name": "2025.05.15 Grafica 3 CTA Mas Informaci√≥n", "adset_name": "2025.06.18 TT (Los ANDES) Segmentacion detallada advantage + RRSS, WEB y BBDD", "campaign_name": "2025.06.18 [4ta ITERACI√ìN] Generacion de Consultas Sculpt", "spend": 860152.0, "impressions": 312048, "clicks": 2878, "ctr": 0.922294, "cpc": 298.871439, "cpm": 2756.473363, "reach": 54656, "link_clicks": 1796, "add_to_cart": 4, "initiated_checkout": 0, "purchases": 0, "messages": 22, "engagement": 3934, "results": 22, "cost_per_result": 39097.818181818184, "cost_per_purchase": 0, "cost_per_link_click": 478.926503, "pixel_roas": 0, "date_start": "2025-08-23", "date_stop": "2026-02-23"}, {"ad_name": "2025.05.15 Grafica 1 CTA Mas Informaci√≥n", "adset_name": "2025.06.18 TT (Los ANDES) Segmentacion detallada advantage + RRSS, WEB y BBDD", "campaign_name": "2025.06.18 [4ta ITERACI√ìN] Generacion de Consultas Sculpt", "spend": 815525.0, "impressions": 285607, "clicks": 2560, "ctr": 0.896337, "cpc": 318.564453, "cpm": 2855.409706, "reach": 46789, "link_clicks": 1717, "add_to_cart": 8, "initiated_checkout": 2, "purchases": 1, "messages": 9, "engagement": 3745, "results": 10, "cost_per_result": 81552.5, "cost_per_purchase": 815525.0, "cost_per_link_click": 474.970879, "pixel_roas": 0, "date_start": "2025-08-23", "date_stop": "2026-02-23"}, {"ad_name": "2025.08.16 Brasile√±o Miami", "adset_name": "winners organicos", "campaign_name": "2025.06.Julio Campa√±a unica de depilaci√≥n Laser", "spend": 554507.0, "impressions": 244694, "clicks": 12403, "ctr": 5.06878, "cpc": 44.70749, "cpm": 2266.12422, "reach": 121765, "link_clicks": 9590, "add_to_cart": 4, "initiated_checkout": 1, "purchases": 0, "messages": 505, "engagement": 177548, "results": 505, "cost_per_result": 1098.0336633663367, "cost_per_purchase": 0, "cost_per_link_click": 57.821376, "pixel_roas": 0, "date_start": "2025-08-23", "date_stop": "2026-02-23"}, {"ad_name": "2025.06.24 Reel Org 18/06 CTA Enviar Mensaje - Copia 4", "adset_name": "Winners videos", "campaign_name": "2025.06. Ventas Julio Campa√±a unica de depilaci√≥n Laser - Copia", "spend": 540756.0, "impressions": 487506, "clicks": 69215, "ctr": 14.197774, "cpc": 7.8127, "cpm": 1109.229425, "reach": 382326, "link_clicks": 67058, "add_to_cart": 10, "initiated_checkout": 2, "purchases": 0, "messages": 0, "engagement": 552854, "results": 0, "cost_per_result": 0, "cost_per_purchase": 0, "cost_per_link_click": 8.064004, "pixel_roas": 0, "date_start": "2025-08-23", "date_stop": "2026-02-23"}, {"ad_name": "Se viene cyber! Registrate", "adset_name": "video ads leads", "campaign_name": "campa√±a LEADS de Interacci√≥n PARA CYBER", "spend": 394021.0, "impressions": 400888, "clicks": 16537, "ctr": 4.125092, "cpc": 23.826631, "cpm": 982.870527, "reach": 151983, "link_clicks": 15588, "add_to_cart": 6, "initiated_checkout": 6, "purchases": 1, "messages": 2, "engagement": 264937, "results": 3, "cost_per_result": 131340.33333333334, "cost_per_purchase": 394021.0, "cost_per_link_click": 25.2772, "pixel_roas": 0, "date_start": "2025-08-23", "date_stop": "2026-02-23"}, {"ad_name": "All Products - Ventas (brasile√±o)", "adset_name": "2025.08.15 CATALOGO", "campaign_name": "Ventas  shopy depilaci√≥n l√°ser  Agosto", "spend": 379458.0, "impressions": 607267, "clicks": 31000, "ctr": 5.104839, "cpc": 12.240581, "cpm": 624.861881, "reach": 169724, "link_clicks": 29979, "add_to_cart": 20, "initiated_checkout": 3, "purchases": 0, "messages": 0, "engagement": 60805, "results": 0, "cost_per_result": 0, "cost_per_purchase": 0, "cost_per_link_click": 12.65746, "pixel_roas": 0, "date_start": "2025-08-23", "date_stop": "2026-02-23"}, {"ad_name": "2024.12.05 Reel Nueva sucursal CTA Enviar Mensaje - Copia", "adset_name": "Winners videos", "campaign_name": "2025.06.Julio Campa√±a unica de depilaci√≥n Laser", "spend": 261825.0, "impressions": 121491, "clicks": 1419, "ctr": 1.167988, "cpc": 184.513742, "cpm": 2155.097908, "reach": 19165, "link_clicks": 461, "add_to_cart": 12, "initiated_checkout": 2, "purchases": 2, "messages": 115, "engagement": 34700, "results": 117, "cost_per_result": 2237.8205128205127, "cost_per_purchase": 130912.5, "cost_per_link_click": 567.950108, "pixel_roas": 0, "date_start": "2025-08-23", "date_stop": "2026-02-23"}, {"ad_name": "2024.12.05 Reel Nueva sucursal CTA Enviar Mensaje", "adset_name": "2024.12.05 TT Segmentacion detallada advantage + RRSS, WEB y BBDD", "campaign_name": "2024.12.05 Interaccion Mensajes Nueva sucursal", "spend": 254808.0, "impressions": 136141, "clicks": 2219, "ctr": 1.629928, "cpc": 114.830104, "cpm": 1871.647777, "reach": 32137, "link_clicks": 483, "add_to_cart": 4, "initiated_checkout": 1, "purchases": 0, "messages": 144, "engagement": 46472, "results": 144, "cost_per_result": 1769.5, "cost_per_purchase": 0, "cost_per_link_click": 527.552795, "pixel_roas": 0, "date_start": "2025-08-23", "date_stop": "2026-02-23"}, {"ad_name": "2025.05.15 Grafica 1 CTA Mas Informaci√≥n - Copia", "adset_name": "2025.05.15 TT (SAN FELIPE) Segmentacion detallada advantage + RRSS, WEB y BBDD - Copia", "campaign_name": "2025.06.18 [4ta ITERACI√ìN] Generacion de Consultas Sculpt", "spend": 244451.0, "impressions": 78248, "clicks": 754, "ctr": 0.963603, "cpc": 324.20557, "cpm": 3124.054289, "reach": 15675, "link_clicks": 544, "add_to_cart": 2, "initiated_checkout": 2, "purchases": 3, "messages": 12, "engagement": 1192, "results": 15, "cost_per_result": 16296.733333333334, "cost_per_purchase": 81483.666667, "cost_per_link_click": 449.358456, "pixel_roas": 0, "date_start": "2025-08-23", "date_stop": "2026-02-23"}, {"ad_name": "2025.05.15 Video 3 CTA Mas Informaci√≥n - Copia", "adset_name": "2025.05.15 TT (SAN FELIPE) Segmentacion detallada advantage + RRSS, WEB y BBDD - Copia 2", "campaign_name": "2025.06.18 [4ta ITERACI√ìN] Generacion de Consultas Sculpt", "spend": 219662.0, "impressions": 67518, "clicks": 669, "ctr": 0.990847, "cpc": 328.343797, "cpm": 3253.384283, "reach": 14347, "link_clicks": 495, "add_to_cart": 8, "initiated_checkout": 2, "purchases": 3, "messages": 12, "engagement": 28127, "results": 15, "cost_per_result": 14644.133333333333, "cost_per_purchase": 73220.666667, "cost_per_link_click": 443.761616, "pixel_roas": 0, "date_start": "2025-08-23", "date_stop": "2026-02-23"}, {"ad_name": "All Products - Ventas", "adset_name": "winner videos  depilacion", "campaign_name": "Ventas  shopy depilaci√≥n l√°ser  Agosto", "spend": 181229.0, "impressions": 185647, "clicks": 15282, "ctr": 8.231752, "cpc": 11.858984, "cpm": 976.202147, "reach": 109427, "link_clicks": 14046, "add_to_cart": 12, "initiated_checkout": 1, "purchases": 0, "messages": 0, "engagement": 185144, "results": 0, "cost_per_result": 0, "cost_per_purchase": 0, "cost_per_link_click": 12.902535, "pixel_roas": 0, "date_start": "2025-08-23", "date_stop": "2026-02-23"}, {"ad_name": "video 2 LEANDRA", "adset_name": "videos rehechos", "campaign_name": "2025.06.Julio Campa√±a unica de depilaci√≥n Laser", "spend": 169443.0, "impressions": 79397, "clicks": 1036, "ctr": 1.304835, "cpc": 163.555019, "cpm": 2134.123456, "reach": 29209, "link_clicks": 412, "add_to_cart": 0, "initiated_checkout": 0, "purchases": 0, "messages": 92, "engagement": 29897, "results": 92, "cost_per_result": 1841.7717391304348, "cost_per_purchase": 0, "cost_per_link_click": 411.269417, "pixel_roas": 0, "date_start": "2025-08-23", "date_stop": "2026-02-23"}, {"ad_name": "org√°nico video", "adset_name": "winner videos  depilacion", "campaign_name": "Ventas  shopy depilaci√≥n l√°ser  Agosto", "spend": 166143.0, "impressions": 129594, "clicks": 12594, "ctr": 9.718043, "cpc": 13.192234, "cpm": 1282.026946, "reach": 77391, "link_clicks": 12123, "add_to_cart": 2, "initiated_checkout": 0, "purchases": 0, "messages": 0, "engagement": 118105, "results": 0, "cost_per_result": 0, "cost_per_purchase": 0, "cost_per_link_click": 13.704776, "pixel_roas": 0, "date_start": "2025-08-23", "date_stop": "2026-02-23"}, {"ad_name": "2025.05.15 Grafica 3 CTA Mas Informaci√≥n", "adset_name": "2025.06.18 TT (Los ANDES) Segmentacion detallada advantage + RRSS, WEB y BBDD", "campaign_name": "2025.06.18 [4ta ITERACI√ìN] Generacion de Consultas Sculpt", "spend": 157511.0, "impressions": 56653, "clicks": 743, "ctr": 1.311493, "cpc": 211.993271, "cpm": 2780.27642, "reach": 19439, "link_clicks": 405, "add_to_cart": 0, "initiated_checkout": 0, "purchases": 0, "messages": 1, "engagement": 869, "results": 1, "cost_per_result": 157511.0, "cost_per_purchase": 0, "cost_per_link_click": 388.916049, "pixel_roas": 0, "date_start": "2025-08-23", "date_stop": "2026-02-23"}, {"ad_name": "2025.05.15 Video 1 CTA Mas Informaci√≥n", "adset_name": "2025.06.18 TT (Los ANDES) Segmentacion detallada advantage + RRSS, WEB y BBDD", "campaign_name": "2025.06.18 [4ta ITERACI√ìN] Generacion de Consultas Sculpt", "spend": 128523.0, "impressions": 36612, "clicks": 482, "ctr": 1.316508, "cpc": 266.645228, "cpm": 3510.406424, "reach": 12054, "link_clicks": 388, "add_to_cart": 2, "initiated_checkout": 0, "purchases": 0, "messages": 5, "engagement": 14543, "results": 5, "cost_per_result": 25704.6, "cost_per_purchase": 0, "cost_per_link_click": 331.244845, "pixel_roas": 0, "date_start": "2025-08-23", "date_stop": "2026-02-23"}, {"ad_name": "2025.05.15 Grafica 1 CTA Mas Informaci√≥n - Copia", "adset_name": "2025.05.15 TT (SAN FELIPE) Segmentacion detallada advantage + RRSS, WEB y BBDD - Copia 2", "campaign_name": "2025.06.18 [4ta ITERACI√ìN] Generacion de Consultas Sculpt", "spend": 113545.0, "impressions": 28860, "clicks": 332, "ctr": 1.150381, "cpc": 342.003012, "cpm": 3934.338184, "reach": 8848, "link_clicks": 209, "add_to_cart": 6, "initiated_checkout": 2, "purchases": 2, "messages": 5, "engagement": 457, "results": 7, "cost_per_result": 16220.714285714286, "cost_per_purchase": 56772.5, "cost_per_link_click": 543.277512, "pixel_roas": 0, "date_start": "2025-08-23", "date_stop": "2026-02-23"}, {"ad_name": "video 2 -HOOK ABI", "adset_name": "videos rehechos", "campaign_name": "2025.06.Julio Campa√±a unica de depilaci√≥n Laser", "spend": 109774.0, "impressions": 59725, "clicks": 591, "ctr": 0.989535, "cpc": 185.742809, "cpm": 1837.990791, "reach": 22828, "link_clicks": 282, "add_to_cart": 0, "initiated_checkout": 0, "purchases": 0, "messages": 40, "engagement": 17900, "results": 40, "cost_per_result": 2744.35, "cost_per_purchase": 0, "cost_per_link_click": 389.269504, "pixel_roas": 0, "date_start": "2025-08-23", "date_stop": "2026-02-23"}, {"ad_name": "2025.05.15 Grafica 3 CTA Mas Informaci√≥n - Copia", "adset_name": "2025.05.15 TT (SAN FELIPE) Segmentacion detallada advantage + RRSS, WEB y BBDD - Copia", "campaign_name": "2025.06.18 [4ta ITERACI√ìN] Generacion de Consultas Sculpt", "spend": 100880.0, "impressions": 32088, "clicks": 342, "ctr": 1.065819, "cpc": 294.97076, "cpm": 3143.8544, "reach": 10024, "link_clicks": 218, "add_to_cart": 2, "initiated_checkout": 1, "purchases": 3, "messages": 1, "engagement": 514, "results": 4, "cost_per_result": 25220.0, "cost_per_purchase": 33626.666667, "cost_per_link_click": 462.752294, "pixel_roas": 0, "date_start": "2025-08-23", "date_stop": "2026-02-23"}], "campaigns_list": [{"id": "120240116854600556", "name": "New | AON - WEB - Ventas - Depilaci√≥n L√°ser audience | 10.02", "objective": "OUTCOME_SALES", "status": "ACTIVE"}, {"id": "120239424325660556", "name": "AON - WSP - ENG - Depilaci√≥n Laser | 24.01 ‚Äì Copy", "objective": "OUTCOME_ENGAGEMENT", "status": "PAUSED"}, {"id": "120239411260080556", "name": "AON - WEB - Ventas - Depilaci√≥n L√°ser audience | 25.01", "objective": "OUTCOME_SALES", "status": "PAUSED"}, {"id": "120239387718660556", "name": "AON - WSP - ENG - Depilaci√≥n Laser | 24.01", "objective": "OUTCOME_ENGAGEMENT", "status": "PAUSED"}, {"id": "120239353027460556", "name": "AON RMKT - WSP - Lead - Depilaci√≥n Laser | 13.01", "objective": "OUTCOME_LEADS", "status": "PAUSED"}, {"id": "120239307820480556", "name": "Sculpt Freeze | LL 1% | 22.01", "objective": "OUTCOME_LEADS", "status": "ACTIVE"}, {"id": "120239257434410556", "name": "AON - WEB - Ventas - Depilaci√≥n L√°ser | 21.01", "objective": "OUTCOME_SALES", "status": "PAUSED"}, {"id": "120238918349020556", "name": "AON - WSP - Lead - Depilaci√≥n Laser | 13.01", "objective": "OUTCOME_LEADS", "status": "ACTIVE"}, {"id": "120238020493140556", "name": "CBO VENTAS NAVIDAD (FK)", "objective": "OUTCOME_SALES", "status": "PAUSED"}, {"id": "120237935277010556", "name": "Retargeting - depilaci√≥n laser", "objective": "OUTCOME_SALES", "status": "PAUSED"}, {"id": "120237934637670556", "name": "ESCALADA depilacion laser alexandrita", "objective": "OUTCOME_SALES", "status": "PAUSED"}, {"id": "120237838994480556", "name": "PR0SPECCI√ìN depilaci√≥n laser", "objective": "OUTCOME_SALES", "status": "PAUSED"}, {"id": "120237809429930556", "name": "PROSPECCI√ìN navidad 2025", "objective": "OUTCOME_SALES", "status": "PAUSED"}, {"id": "120236408971580556", "name": "CBO  KYEST - HOMBRES", "objective": "OUTCOME_SALES", "status": "PAUSED"}, {"id": "120236183578130556", "name": "CBO  BLACK FRIDAY 2025", "objective": "OUTCOME_SALES", "status": "PAUSED"}, {"id": "120236033001880556", "name": "LEADS PARA BLACK KYEST 2025", "objective": "OUTCOME_LEADS", "status": "PAUSED"}, {"id": "120235977157520556", "name": "campa√±a LEADS de Interacci√≥n PARA BLACK FRIDAY", "objective": "OUTCOME_ENGAGEMENT", "status": "PAUSED"}, {"id": "120233200373640556", "name": "15.09.2025 CBO CYBER DAY KYEST - Hombre", "objective": "OUTCOME_SALES", "status": "PAUSED"}, {"id": "120233064699520556", "name": "campa√±a LEADS de Interacci√≥n PARA CYBER - Copia", "objective": "OUTCOME_LEADS", "status": "PAUSED"}, {"id": "120232651821670556", "name": "CBO KYEST DEPILACION LASER mujer cyber ok", "objective": "OUTCOME_SALES", "status": "PAUSED"}, {"id": "120232651821660556", "name": "AON - WEB - Venta - Depilacion | React. 04.02", "objective": "OUTCOME_SALES", "status": "PAUSED"}, {"id": "120232630182390556", "name": "15.09.2025 CBO CYBER DAY KYEST mujer", "objective": "OUTCOME_SALES", "status": "PAUSED"}, {"id": "120232559650660556", "name": "Campa√±a Campa√±a de clientes potenciales para CYBER  13/9/2025 Campa√±a", "objective": "OUTCOME_LEADS", "status": "PAUSED"}, {"id": "120232278143960556", "name": "campa√±a LEADS de Interacci√≥n PARA CYBER", "objective": "OUTCOME_ENGAGEMENT", "status": "PAUSED"}, {"id": "120230910338890556", "name": "Ventas  shopy depilaci√≥n l√°ser  Agosto", "objective": "OUTCOME_SALES", "status": "PAUSED"}, {"id": "120229949950170556", "name": "Campa√±a de Tr√°fico con la configuraci√≥n recomendada", "objective": "OUTCOME_TRAFFIC", "status": "PAUSED"}, {"id": "120229932868850556", "name": "2025.06. Ventas Julio Campa√±a unica de depilaci√≥n Laser - Copia", "objective": "OUTCOME_TRAFFIC", "status": "PAUSED"}, {"id": "120229931258060556", "name": "2025.06.Copia Julio Campa√±a unica de depilaci√≥n Laser - Copia", "objective": "OUTCOME_SALES", "status": "PAUSED"}, {"id": "120229740056390556", "name": "2025.06. copia Julio Campa√±a unica de depilaci√≥n Laser", "objective": "OUTCOME_TRAFFIC", "status": "PAUSED"}, {"id": "120229036654790556", "name": "Ventas", "objective": "OUTCOME_SALES", "status": "PAUSED"}, {"id": "120229036297540556", "name": "2025.06.Julio Campa√±a unica de depilaci√≥n Laser - Copia", "objective": "OUTCOME_TRAFFIC", "status": "PAUSED"}, {"id": "120228697322930556", "name": "2025.06.Julio Campa√±a unica de depilaci√≥n Laser", "objective": "OUTCOME_ENGAGEMENT", "status": "PAUSED"}, {"id": "120228605380550556", "name": "Dep laser Campa√±a de Tr√°fico con la configuraci√≥n recomendada", "objective": "OUTCOME_TRAFFIC", "status": "PAUSED"}, {"id": "120227626070290556", "name": "2025.06.18 [4ta ITERACI√ìN] Generacion de Consultas Sculpt", "objective": "OUTCOME_LEADS", "status": "PAUSED"}, {"id": "120227477265340556", "name": "2025.06.16 Interaccion Mensajes Nueva sucursal", "objective": "OUTCOME_ENGAGEMENT", "status": "PAUSED"}, {"id": "120226066737100556", "name": "2025.05.26 Interaccion Mensajes Cyber Armonizaci√≥n y Acn√©", "objective": "OUTCOME_ENGAGEMENT", "status": "PAUSED"}, {"id": "120226065437880556", "name": "2025.05.26 Interaccion Mensajes Cyber Depilaci√≥n", "objective": "OUTCOME_ENGAGEMENT", "status": "PAUSED"}, {"id": "120225531233320556", "name": "2025.05.22 Posicionamiento Depilaci√≥n", "objective": "OUTCOME_AWARENESS", "status": "PAUSED"}, {"id": "120225274289110556", "name": "2025.05.15 [3ra ITERACI√ìN] Generacion de Consultas Sculpt Freeze", "objective": "OUTCOME_LEADS", "status": "PAUSED"}, {"id": "120224767968550556", "name": "2025.04.28 Interaccion Mensajes Dia de la madre - Correcci√≥n de numero - Copia", "objective": "OUTCOME_ENGAGEMENT", "status": "PAUSED"}, {"id": "120224513735600556", "name": "2025.04.28 Interaccion Mensajes Dia de la madre - Correcci√≥n de numero", "objective": "OUTCOME_ENGAGEMENT", "status": "PAUSED"}, {"id": "120223120124550556", "name": "2025.04.28 Interaccion Mensajes Dia de la madre", "objective": "OUTCOME_ENGAGEMENT", "status": "PAUSED"}, {"id": "120221497384930556", "name": "2025.04.11 [2da ITERACI√ìN] Generacion de Consultas Sculpt Freeze", "objective": "OUTCOME_LEADS", "status": "PAUSED"}, {"id": "120218225451240556", "name": "2025.03.05 [1er ITERACI√ìN] Generacion de Consultas Sculpt Freeze", "objective": "OUTCOME_LEADS", "status": "PAUSED"}, {"id": "120218162852580556", "name": "2025.03.03 Interaccion Mensajes Servicios Generales Los Andes", "objective": "OUTCOME_ENGAGEMENT", "status": "PAUSED"}, {"id": "120218162408490556", "name": "2025.03.03 Interaccion Mensajes Depilacion San Felipe", "objective": "OUTCOME_ENGAGEMENT", "status": "PAUSED"}, {"id": "120218161718730556", "name": "2025.03.03 Interaccion Mensajes Depilacion Los Andes", "objective": "OUTCOME_ENGAGEMENT", "status": "PAUSED"}, {"id": "120217746394980556", "name": "2024.02.24 Interaccion Mensajes Nueva sucursal", "objective": "OUTCOME_ENGAGEMENT", "status": "PAUSED"}, {"id": "120216318290710556", "name": "2024.02.03 Interaccion Mensajes Gift Box San Valentin", "objective": "OUTCOME_ENGAGEMENT", "status": "PAUSED"}, {"id": "120216317371600556", "name": "2024.02.03 Interaccion Mensajes Depilacion Febrero", "objective": "OUTCOME_ENGAGEMENT", "status": "PAUSED"}], "ga4_channels": [{"channel": "Paid Social", "sessions": 2879, "users": 2249, "new": 2219, "conv": 1, "revenue": 50000, "bounce": 75.3, "duration": 84}, {"channel": "Organic Search", "sessions": 1131, "users": 690, "new": 678, "conv": 5, "revenue": 642000, "bounce": 32.9, "duration": 239}, {"channel": "Direct", "sessions": 1089, "users": 797, "new": 798, "conv": 25, "revenue": 3892750, "bounce": 48.9, "duration": 132}, {"channel": "Organic Social", "sessions": 1052, "users": 912, "new": 889, "conv": 5, "revenue": 615090, "bounce": 48.2, "duration": 126}, {"channel": "Paid Other", "sessions": 648, "users": 351, "new": 325, "conv": 0, "revenue": 0, "bounce": 64.8, "duration": 0}, {"channel": "Referral", "sessions": 187, "users": 107, "new": 100, "conv": 0, "revenue": 0, "bounce": 40.6, "duration": 367}, {"channel": "Unassigned", "sessions": 144, "users": 98, "new": 35, "conv": 2, "revenue": 50000, "bounce": 0, "duration": 0}, {"channel": "Organic Shopping", "sessions": 50, "users": 10, "new": 7, "conv": 1, "revenue": 0, "bounce": 0, "duration": 0}, {"channel": "Email", "sessions": 29, "users": 12, "new": 10, "conv": 0, "revenue": 0, "bounce": 0, "duration": 0}, {"channel": "Paid Search", "sessions": 7, "users": 7, "new": 7, "conv": 0, "revenue": 0, "bounce": 0, "duration": 0}], "ga4_monthly": [{"month": "Ene 2026", "sessions": 2523, "users": 1885, "new": 1883, "conv": 18, "revenue": 2161150}, {"month": "Feb 2026", "sessions": 4638, "users": 3289, "new": 3185, "conv": 21, "revenue": 3088690}], "ga4_devices": [{"device": "Mobile", "sessions": 5972, "users": 4576, "conv": 31, "revenue": 4931340, "duration": 131, "bounce": 60}, {"device": "Desktop", "sessions": 1046, "users": 482, "conv": 7, "revenue": 225000, "duration": 333, "bounce": 43}, {"device": "Tablet", "sessions": 48, "users": 39, "conv": 1, "revenue": 93500, "duration": 222, "bounce": 54}]};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FORMATTING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function fCLP(v){
  v=Math.round(v||0);
  return '$'+v.toLocaleString('es-CL');
}
function fNum(v){return Math.round(v||0).toLocaleString('es-CL')}
function fPct(v){return (v||0).toFixed(2)+'%'}
function fDec(v,d=2){return (v||0).toFixed(d)}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHART.JS DEFAULTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Chart.defaults.color='#94A3B8';
Chart.defaults.borderColor='#1E2D4F';
const gridStyle={color:'#1E2D4F'};
const tickStyle={color:'#94A3B8'};
const legendStyle={labels:{color:'#94A3B8',boxWidth:12,padding:12}};
function defScales(yLabel='',y2=false){
  const s={
    x:{grid:gridStyle,ticks:{...tickStyle,maxRotation:45}},
    y:{grid:gridStyle,ticks:tickStyle,title:{display:!!yLabel,text:yLabel,color:'#94A3B8'}}
  };
  if(y2) s.y1={position:'right',grid:{drawOnChartArea:false},ticks:tickStyle};
  return s;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATE FILTER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let fp; // flatpickr instance
let filterStart=null, filterEnd=null;

function parseDate(s){return new Date(s+'T00:00:00')}

function setPreset(p){
  document.querySelectorAll('.preset-btn').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
  const now=new Date();
  let s,e=new Date();
  if(p==='today'){s=new Date(now)}
  else if(p==='7d'){s=new Date(now);s.setDate(s.getDate()-6)}
  else if(p==='30d'){s=new Date(now);s.setDate(s.getDate()-29)}
  else if(p==='3m'){s=new Date(now);s.setMonth(s.getMonth()-3)}
  else if(p==='6m'){s=new Date(now);s.setMonth(s.getMonth()-6)}
  else if(p==='all'){s=new Date('2020-01-01');}
  filterStart=s;filterEnd=e;
  if(fp){fp.setDate([s,e]);}
  updateAll();
}

function initDatePicker(){
  fp=flatpickr('#date-range-input',{
    mode:'range',locale:'es',dateFormat:'d/m/Y',
    defaultDate:[
      new Date(new Date().setMonth(new Date().getMonth()-6)),
      new Date()
    ],
    onChange:function(dates){
      if(dates.length===2){
        filterStart=dates[0];filterEnd=dates[1];
        document.querySelectorAll('.preset-btn').forEach(b=>b.classList.remove('active'));
        updateAll();
      }
    }
  });
  // Default 6m
  const now=new Date();
  const s6=new Date(now);s6.setMonth(s6.getMonth()-6);
  filterStart=s6;filterEnd=now;
}

function inRange(dateStr){
  if(!filterStart||!filterEnd) return true;
  const d=parseDate(dateStr);
  return d>=filterStart && d<=filterEnd;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FILTERED DATA HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getFilteredOrders(){
  return RAW.daily_data.filter(d=>inRange(d.date));
}
function getFilteredMonthly(){
  // Filter monthly data by range
  return RAW.monthly_data.filter(m=>{
    const ms=m.month+'-01';
    const mEnd=m.month+'-28';
    return (!filterStart||parseDate(mEnd)>=filterStart)&&
           (!filterEnd||parseDate(ms)<=filterEnd);
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHART INSTANCES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const charts={};
function destroyChart(id){if(charts[id]){charts[id].destroy();delete charts[id];}}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// OVERVIEW UPDATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateOverview(){
  const daily=getFilteredOrders();
  const rev=daily.reduce((s,d)=>s+d.revenue,0);
  const monthly=getFilteredMonthly();
  const ords=monthly.reduce((s,m)=>s+m.orders,0)||RAW.total_orders;
  const aov=ords>0?rev/ords:RAW.aov;
  
  // Use full meta spend (not filterable by date since Meta is total period)
  const spend=RAW.meta_spend;
  const roas=spend>0?rev/spend:0;
  const net=rev-spend;
  
  document.getElementById('ov-revenue').textContent=fCLP(rev);
  document.getElementById('ov-orders').textContent=fNum(ords);
  document.getElementById('ov-aov').textContent=fCLP(aov);
  document.getElementById('ov-spend').textContent=fCLP(spend);
  
  const roasEl=document.getElementById('ov-roas');
  roasEl.textContent=fDec(roas)+'x';
  const roasCard=document.getElementById('ov-roas-card');
  roasCard.style.borderColor=roas<3?'#EF4444':roas<7?'#F59E0B':'#10B981';
  roasEl.className='kpi-value '+(roas<3?'text-red':roas<7?'text-yellow':'text-green');
  
  document.getElementById('ov-net').textContent=fCLP(net);
  document.getElementById('ov-net').className='kpi-value '+(net>=0?'text-green':'text-red');
  
  // Range label
  const label=filterStart&&filterEnd?
    filterStart.toLocaleDateString('es-CL')+' ‚Äî '+filterEnd.toLocaleDateString('es-CL'):'';
  document.getElementById('overview-range-label').textContent=label;
  
  // Charts
  updateRevSpendChart(daily);
  updateFunnel();
  updateRoasTrend();
}

function updateRevSpendChart(daily){
  destroyChart('rev-spend');
  const ctx=document.getElementById('chart-rev-spend').getContext('2d');
  // Group daily meta spend from monthly
  const labels=daily.map(d=>d.date);
  const revData=daily.map(d=>d.revenue);
  // Distribute meta spend proportionally across days
  const totalDays=daily.length||1;
  const dailySpend=RAW.meta_spend/totalDays;
  const spendData=daily.map(()=>dailySpend);
  
  charts['rev-spend']=new Chart(ctx,{
    type:'bar',
    data:{
      labels,
      datasets:[
        {label:'Revenue (CLP)',data:revData,backgroundColor:'rgba(59,130,246,.7)',
         yAxisID:'y',order:1},
        {label:'Gasto Meta (est.)',data:spendData,type:'line',
         borderColor:'#F59E0B',backgroundColor:'rgba(245,158,11,.1)',
         yAxisID:'y',fill:true,tension:.3,pointRadius:0,order:0}
      ]
    },
    options:{
      responsive:true,maintainAspectRatio:false,
      plugins:{legend:legendStyle,tooltip:{mode:'index',intersect:false,
        callbacks:{label:ctx=>ctx.dataset.label+': '+fCLP(ctx.raw)}}},
      scales:{
        x:{grid:gridStyle,ticks:{...tickStyle,maxTicksLimit:10,maxRotation:45}},
        y:{grid:gridStyle,ticks:{...tickStyle,callback:v=>'$'+(v/1e6).toFixed(1)+'M'}}
      }
    }
  });
}

function updateFunnel(){
  const mt=RAW.meta_totals;
  // GA sessions as top
  const ga_sessions=7216; // total GA sessions
  const add_cart=mt.add_to_cart||0;
  const checkout=0; // not available in overview
  const purch=mt.purchases||0;
  
  const steps=[
    {label:'Sesiones',val:ga_sessions,color:'#3B82F6'},
    {label:'Clicks Meta',val:mt.clicks||0,color:'#8B5CF6'},
    {label:'Add to Cart',val:add_cart,color:'#F59E0B'},
    {label:'Mensajes',val:mt.messages||0,color:'#10B981'},
    {label:'Compras',val:purch,color:'#EF4444'},
  ];
  const max=steps[0].val||1;
  const fw=document.getElementById('funnel-wrap');
  fw.innerHTML=steps.map(s=>{
    const pct=Math.round(s.val/max*100);
    return `<div class="funnel-row">
      <div class="funnel-label">${s.label}</div>
      <div class="funnel-bar-wrap">
        <div class="funnel-bar" style="width:${pct}%;background:${s.color}">
          ${pct}%
        </div>
      </div>
      <div class="funnel-val">${fNum(s.val)}</div>
    </div>`;
  }).join('');
}

function updateRoasTrend(){
  destroyChart('roas-trend');
  const ctx=document.getElementById('chart-roas-trend').getContext('2d');
  const mm=RAW.meta_monthly;
  const monthly=RAW.monthly_data;
  
  // Compute roas per month
  const labels=mm.map(m=>m.label);
  const roasData=mm.map(m=>{
    const mLabel=m.label;
    const md=monthly.find(x=>x.month===mLabel);
    const rev=md?md.revenue:0;
    return m.spend>0?(rev/m.spend).toFixed(2):0;
  });
  
  charts['roas-trend']=new Chart(ctx,{
    type:'line',
    data:{
      labels,
      datasets:[{
        label:'ROAS Real',data:roasData,
        borderColor:'#3B82F6',backgroundColor:'rgba(59,130,246,.1)',
        fill:true,tension:.3,pointRadius:4,
        pointBackgroundColor:roasData.map(v=>v<3?'#EF4444':v<7?'#F59E0B':'#10B981')
      }]
    },
    options:{
      responsive:true,maintainAspectRatio:false,
      plugins:{legend:legendStyle,
        annotation:{annotations:{line1:{type:'line',yMin:3,yMax:3,borderColor:'#EF4444',borderDash:[4,4]}}}},
      scales:{
        x:{grid:gridStyle,ticks:tickStyle},
        y:{grid:gridStyle,ticks:tickStyle,suggestedMin:0,suggestedMax:10}
      }
    }
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// META UPDATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateMeta(){
  const mt=RAW.meta_totals;
  document.getElementById('m-spend').textContent=fCLP(mt.spend);
  document.getElementById('m-imp').textContent=fNum(mt.impressions);
  document.getElementById('m-clicks').textContent=fNum(mt.clicks);
  document.getElementById('m-ctr').textContent=fDec(mt.avg_ctr)+'%';
  document.getElementById('m-cpc').textContent=fCLP(mt.avg_cpc);
  document.getElementById('m-cpm').textContent=fCLP(mt.avg_cpm);
  document.getElementById('m-reach').textContent=fNum(mt.reach);
  document.getElementById('m-msg').textContent=fNum(mt.messages);
  document.getElementById('m-purch').textContent=fNum(mt.pixel_purchases);
  
  // Pixel alert
  const pixelPurch=RAW.pixel_purchases;
  const pixelRoas=RAW.pixel_roas;
  const realRoas=RAW.real_roas;
  document.getElementById('pixel-alert-title').innerHTML=
    `‚ö†Ô∏è PIXEL ROTO ‚Äî Meta atribuye <strong>${fNum(pixelPurch)} compras</strong> ¬∑ ROAS pixel: <strong>${fDec(pixelRoas)}x</strong> ¬∑ ROAS Real (Shopify/Spend): <strong>${fDec(realRoas)}x</strong>`;
  document.getElementById('pixel-alert-sub').textContent=
    'El pixel de Meta no registra correctamente las conversiones. Los datos de Shopify son la fuente de verdad.';
  
  // Meta monthly chart
  buildMetaMonthlyChart();
  // Campaign charts
  buildCampCharts();
  // Campaign table
  buildCampaignTable();
}

function buildCampCharts(){
  // Top campaigns by spend (bar)
  destroyChart('camp-spend');
  const ctx1=document.getElementById('chart-camp-spend').getContext('2d');
  const top10=RAW.campaign_rows.slice(0,10);
  charts['camp-spend']=new Chart(ctx1,{
    type:'bar',
    data:{
      labels:top10.map(c=>c.name.length>30?c.name.substring(0,30)+'‚Ä¶':c.name),
      datasets:[{
        label:'Gasto (CLP)',data:top10.map(c=>c.spend),
        backgroundColor:top10.map(c=>c.status==='ACTIVE'?'rgba(59,130,246,.8)':'rgba(100,116,139,.5)'),
      }]
    },
    options:{
      indexAxis:'y',responsive:true,maintainAspectRatio:false,
      plugins:{legend:{display:false},tooltip:{callbacks:{label:ctx=>fCLP(ctx.raw)}}},
      scales:{
        x:{grid:gridStyle,ticks:{...tickStyle,callback:v=>'$'+(v/1e6).toFixed(1)+'M'}},
        y:{grid:gridStyle,ticks:{...tickStyle,font:{size:10}}}
      }
    }
  });
  
  // CTR by campaign
  destroyChart('camp-ctr');
  const ctx2=document.getElementById('chart-camp-ctr').getContext('2d');
  const byCTR=[...RAW.campaign_rows].sort((a,b)=>b.ctr-a.ctr).slice(0,10);
  charts['camp-ctr']=new Chart(ctx2,{
    type:'bar',
    data:{
      labels:byCTR.map(c=>c.name.length>30?c.name.substring(0,30)+'‚Ä¶':c.name),
      datasets:[{
        label:'CTR (%)',data:byCTR.map(c=>c.ctr.toFixed(2)),
        backgroundColor:byCTR.map(c=>c.ctr>3?'rgba(16,185,129,.8)':c.ctr>1?'rgba(245,158,11,.8)':'rgba(239,68,68,.8)'),
      }]
    },
    options:{
      indexAxis:'y',responsive:true,maintainAspectRatio:false,
      plugins:{legend:{display:false},tooltip:{callbacks:{label:ctx=>ctx.raw+'%'}}},
      scales:{
        x:{grid:gridStyle,ticks:{...tickStyle,callback:v=>v+'%'}},
        y:{grid:gridStyle,ticks:{...tickStyle,font:{size:10}}}
      }
    }
  });
}

function buildMetaMonthlyChart(){
  destroyChart('meta-monthly');
  const ctx=document.getElementById('chart-meta-monthly').getContext('2d');
  const mm=RAW.meta_monthly;
  charts['meta-monthly']=new Chart(ctx,{
    data:{
      labels:mm.map(m=>m.label),
      datasets:[
        {type:'bar',label:'Gasto (CLP)',data:mm.map(m=>m.spend),
         backgroundColor:'rgba(245,158,11,.7)',yAxisID:'y'},
        {type:'line',label:'Clicks',data:mm.map(m=>m.clicks),
         borderColor:'#3B82F6',fill:false,tension:.3,yAxisID:'y1',pointRadius:4},
        {type:'line',label:'Mensajes',data:mm.map(m=>m.messages),
         borderColor:'#10B981',fill:false,tension:.3,yAxisID:'y1',pointRadius:4,borderDash:[4,4]}
      ]
    },
    options:{
      responsive:true,maintainAspectRatio:false,
      plugins:{legend:legendStyle,tooltip:{mode:'index',intersect:false}},
      scales:{
        x:{grid:gridStyle,ticks:tickStyle},
        y:{grid:gridStyle,ticks:{...tickStyle,callback:v=>'$'+(v/1e6).toFixed(1)+'M'}},
        y1:{position:'right',grid:{drawOnChartArea:false},ticks:tickStyle}
      }
    }
  });
}

function buildCampaignTable(){
  const tbody=document.getElementById('campaign-tbody');
  const rows=RAW.campaign_rows;
  tbody.innerHTML=rows.map(r=>{
    const statusBadge=r.status==='ACTIVE'?'badge-green':r.status==='PAUSED'?'badge-gray':'badge-red';
    const objShort=(r.objective||'‚Äî').replace('OUTCOME_','');
    return `<tr>
      <td style="max-width:220px;overflow:hidden;text-overflow:ellipsis" title="${r.name}">${r.name}</td>
      <td><span class="badge badge-blue">${objShort}</span></td>
      <td><span class="badge ${statusBadge}">${r.status}</span></td>
      <td>${fCLP(r.spend)}</td>
      <td>${fNum(r.impressions)}</td>
      <td>${fNum(r.clicks)}</td>
      <td class="${r.ctr>3?'ctr-high':r.ctr>1?'ctr-mid':'ctr-low'}">${fDec(r.ctr)}%</td>
      <td>${fCLP(r.cpc)}</td>
      <td>${fCLP(r.cpm)}</td>
      <td>${fNum(r.reach)}</td>
      <td>${fNum(r.messages)}</td>
      <td>${fNum(r.add_to_cart)}</td>
      <td>${fNum(r.purchases)}</td>
      <td>${r.results>0?fCLP(r.cost_per_result):'‚Äî'}</td>
    </tr>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ANUNCIOS UPDATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateAnuncios(){
  buildAdsTable();
  buildAdsetsTable();
}

// Find max CTR and spend for icons
function buildAdsTable(filter=''){
  const tbody=document.getElementById('ads-tbody');
  let rows=RAW.ads_rows;
  if(filter) rows=rows.filter(r=>r.ad_name.toLowerCase().includes(filter.toLowerCase())||
    r.adset_name.toLowerCase().includes(filter.toLowerCase())||
    r.campaign_name.toLowerCase().includes(filter.toLowerCase()));
  
  const maxCTR=Math.max(...rows.map(r=>r.ctr));
  const maxSpend=Math.max(...rows.map(r=>r.spend));
  
  tbody.innerHTML=rows.map(r=>{
    const isBestCTR=r.ctr===maxCTR&&r.ctr>0;
    const isTopSpend=r.spend===maxSpend;
    const ctrClass=r.ctr>3?'ctr-high':r.ctr>1?'ctr-mid':'ctr-low';
    return `<tr>
      <td style="max-width:200px;overflow:hidden;text-overflow:ellipsis" title="${r.ad_name}">
        ${isTopSpend?'üî• ':''} ${isBestCTR?'üèÜ ':''} ${r.ad_name}
      </td>
      <td style="max-width:160px;overflow:hidden;text-overflow:ellipsis" title="${r.adset_name}">${r.adset_name}</td>
      <td style="max-width:140px;overflow:hidden;text-overflow:ellipsis" title="${r.campaign_name}">${r.campaign_name}</td>
      <td>${fCLP(r.spend)}</td>
      <td>${fNum(r.impressions)}</td>
      <td>${fNum(r.clicks)}</td>
      <td class="${ctrClass}">${fDec(r.ctr)}%</td>
      <td>${fCLP(r.cpc)}</td>
      <td>${fCLP(r.cpm)}</td>
      <td>${fNum(r.reach)}</td>
      <td>${fNum(r.results)}</td>
      <td>${r.results>0?fCLP(r.cost_per_result):'‚Äî'}</td>
      <td>${fNum(r.engagement)}</td>
    </tr>`;
  }).join('');
}

function buildAdsetsTable(){
  const tbody=document.getElementById('adsets-tbody');
  tbody.innerHTML=RAW.adset_rows.map(r=>{
    return `<tr>
      <td style="max-width:200px;overflow:hidden;text-overflow:ellipsis" title="${r.name}">${r.name}</td>
      <td style="max-width:160px;overflow:hidden;text-overflow:ellipsis" title="${r.campaign}">${r.campaign}</td>
      <td>${fCLP(r.spend)}</td>
      <td>${fNum(r.impressions)}</td>
      <td>${fNum(r.clicks)}</td>
      <td class="${r.ctr>3?'ctr-high':r.ctr>1?'ctr-mid':'ctr-low'}">${fDec(r.ctr)}%</td>
      <td>${fCLP(r.cpc)}</td>
      <td>${fNum(r.messages)}</td>
      <td>${fNum(r.purchases)}</td>
    </tr>`;
  }).join('');
}

function filterAdsTable(){
  const q=document.getElementById('ads-search').value;
  buildAdsTable(q);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SHOPIFY UPDATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateShopify(){
  const monthly=getFilteredMonthly();
  const rev=monthly.reduce((s,m)=>s+m.revenue,0)||RAW.total_revenue;
  const ords=monthly.reduce((s,m)=>s+m.orders,0)||RAW.total_orders;
  const newC=monthly.reduce((s,m)=>s+m.new,0);
  const repC=monthly.reduce((s,m)=>s+m.repeat,0);
  const aov=ords>0?rev/ords:RAW.aov;
  const retRate=RAW.repeat_rate;
  
  document.getElementById('sh-rev').textContent=fCLP(rev);
  document.getElementById('sh-ord').textContent=fNum(ords);
  document.getElementById('sh-aov').textContent=fCLP(aov);
  document.getElementById('sh-new').textContent=fNum(newC);
  document.getElementById('sh-rep').textContent=fNum(repC);
  document.getElementById('sh-ret').textContent=fDec(retRate*100)+'%';
  
  // Monthly revenue chart
  destroyChart('monthly-rev');
  const ctx1=document.getElementById('chart-monthly-rev').getContext('2d');
  charts['monthly-rev']=new Chart(ctx1,{
    data:{
      labels:monthly.map(m=>m.month),
      datasets:[
        {type:'bar',label:'Revenue',data:monthly.map(m=>m.revenue),
         backgroundColor:'rgba(59,130,246,.7)',yAxisID:'y'},
        {type:'line',label:'√ìrdenes',data:monthly.map(m=>m.orders),
         borderColor:'#10B981',backgroundColor:'rgba(16,185,129,.1)',
         fill:false,tension:.3,yAxisID:'y1',pointRadius:4}
      ]
    },
    options:{
      responsive:true,maintainAspectRatio:false,
      plugins:{legend:legendStyle},
      scales:{
        x:{grid:gridStyle,ticks:tickStyle},
        y:{grid:gridStyle,ticks:{...tickStyle,callback:v=>'$'+(v/1e6).toFixed(1)+'M'}},
        y1:{position:'right',grid:{drawOnChartArea:false},ticks:tickStyle}
      }
    }
  });
  
  // Customer type chart
  destroyChart('cust-type');
  const ctx2=document.getElementById('chart-cust-type').getContext('2d');
  charts['cust-type']=new Chart(ctx2,{
    type:'bar',
    data:{
      labels:monthly.map(m=>m.month),
      datasets:[
        {label:'Nuevos',data:monthly.map(m=>m.new),backgroundColor:'rgba(59,130,246,.7)'},
        {label:'Repetidores',data:monthly.map(m=>m.repeat),backgroundColor:'rgba(139,92,246,.7)'}
      ]
    },
    options:{
      responsive:true,maintainAspectRatio:false,
      plugins:{legend:legendStyle},
      scales:{x:{grid:gridStyle,ticks:tickStyle,stacked:true},
              y:{grid:gridStyle,ticks:tickStyle,stacked:true}}
    }
  });
  
  // Products chart
  destroyChart('products');
  const ctx3=document.getElementById('chart-products').getContext('2d');
  const prods=RAW.top_products;
  charts['products']=new Chart(ctx3,{
    type:'bar',
    data:{
      labels:prods.map(p=>p.name.length>35?p.name.substring(0,35)+'...':p.name),
      datasets:[
        {label:'Revenue (CLP)',data:prods.map(p=>p.revenue),
         backgroundColor:'rgba(59,130,246,.7)',yAxisID:'y'},
        {label:'Unidades',data:prods.map(p=>p.units),
         backgroundColor:'rgba(16,185,129,.7)',yAxisID:'y1'}
      ]
    },
    options:{
      indexAxis:'y',responsive:true,maintainAspectRatio:false,
      plugins:{legend:legendStyle},
      scales:{
        x:{grid:gridStyle,ticks:{...tickStyle,callback:v=>'$'+(v/1e6).toFixed(1)+'M'}},
        y:{grid:gridStyle,ticks:{...tickStyle,font:{size:11}}},
        y1:{display:false}
      }
    }
  });
  
  // Financial status donut
  destroyChart('fin-status');
  const ctx4=document.getElementById('chart-fin-status').getContext('2d');
  const fs=RAW.financial_status;
  const fsKeys=Object.keys(fs);
  const fsColors={paid:'#10B981',pending:'#F59E0B',refunded:'#EF4444',voided:'#94A3B8',authorized:'#3B82F6'};
  charts['fin-status']=new Chart(ctx4,{
    type:'doughnut',
    data:{
      labels:fsKeys,
      datasets:[{
        data:fsKeys.map(k=>fs[k]),
        backgroundColor:fsKeys.map(k=>fsColors[k]||'#64748B'),
        borderWidth:0
      }]
    },
    options:{
      responsive:true,maintainAspectRatio:false,
      plugins:{legend:{...legendStyle,position:'bottom'}}
    }
  });
  
  // Orders table
  buildOrdersTable();
}

function buildOrdersTable(){
  const tbody=document.getElementById('orders-tbody');
  tbody.innerHTML=RAW.last_20_orders.map(o=>{
    const fsBadge=o.financial_status==='paid'?'badge-green':
                   o.financial_status==='pending'?'badge-yellow':'badge-red';
    const ffBadge=o.fulfillment_status==='fulfilled'?'badge-green':'badge-gray';
    return `<tr>
      <td>#${o.id}</td>
      <td>${o.created_at}</td>
      <td style="max-width:120px;overflow:hidden;text-overflow:ellipsis" title="${o.customer}">${o.customer}</td>
      <td>${fCLP(o.total_price)}</td>
      <td><span class="badge ${fsBadge}">${o.financial_status}</span></td>
      <td><span class="badge ${ffBadge}">${o.fulfillment_status}</span></td>
      <td>${o.items}</td>
    </tr>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ANALYTICS UPDATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateAnalytics(){
  // Channel table
  const tbody=document.getElementById('ga4-tbody');
  tbody.innerHTML=RAW.ga4_channels.map(c=>{
    const convRate=c.sessions>0?(c.conv/c.sessions*100).toFixed(2):'0.00';
    const bounceCls=c.bounce>70?'text-red':c.bounce>50?'text-yellow':c.bounce>0?'text-green':'';
    const dur=c.duration>0?Math.floor(c.duration/60)+'m'+String(c.duration%60).padStart(2,'0')+'s':'‚Äî';
    return `<tr>
      <td><strong>${c.channel}</strong></td>
      <td>${fNum(c.sessions)}</td>
      <td>${fNum(c.users)}</td>
      <td>${fNum(c.new)}</td>
      <td>${c.conv}</td>
      <td>${c.revenue>0?fCLP(c.revenue):'‚Äî'}</td>
      <td class="${bounceCls}">${c.bounce>0?fDec(c.bounce)+'%':'‚Äî'}</td>
      <td>${dur}</td>
      <td class="${parseFloat(convRate)>1?'text-green':parseFloat(convRate)>.5?'text-yellow':''}">${convRate}%</td>
    </tr>`;
  }).join('');
  
  // Device cards
  const totalSessions=RAW.ga4_devices.reduce((s,d)=>s+d.sessions,0);
  const dg=document.getElementById('device-grid');
  const devIcons={Mobile:'üì±',Desktop:'üñ•Ô∏è',Tablet:'üì≤'};
  dg.innerHTML=RAW.ga4_devices.map(d=>{
    const pct=Math.round(d.sessions/totalSessions*100);
    const dur=d.duration>0?Math.floor(d.duration/60)+'m'+String(d.duration%60).padStart(2,'0')+'s':'‚Äî';
    return `<div class="device-card">
      <div class="device-name">${devIcons[d.device]||''} ${d.device}</div>
      <div class="device-stat">
        <span class="device-stat-label">Sesiones</span>
        <span class="device-stat-value">${fNum(d.sessions)} (${pct}%)</span>
      </div>
      <div class="mini-bar-wrap"><div class="mini-bar" style="width:${pct}%"></div></div>
      <div style="margin-top:10px">
      <div class="device-stat">
        <span class="device-stat-label">Usuarios</span>
        <span class="device-stat-value">${fNum(d.users)}</span>
      </div>
      <div class="device-stat">
        <span class="device-stat-label">Conversiones</span>
        <span class="device-stat-value text-green">${d.conv}</span>
      </div>
      <div class="device-stat">
        <span class="device-stat-label">Revenue</span>
        <span class="device-stat-value">${d.revenue>0?fCLP(d.revenue):'‚Äî'}</span>
      </div>
      <div class="device-stat">
        <span class="device-stat-label">Bounce</span>
        <span class="device-stat-value ${d.bounce>70?'text-red':d.bounce>50?'text-yellow':'text-green'}">${d.bounce}%</span>
      </div>
      <div class="device-stat">
        <span class="device-stat-label">Duraci√≥n</span>
        <span class="device-stat-value">${dur}</span>
      </div>
      </div>
    </div>`;
  }).join('');
  
  // Monthly chart
  destroyChart('ga4-monthly');
  const ctx=document.getElementById('chart-ga4-monthly').getContext('2d');
  charts['ga4-monthly']=new Chart(ctx,{
    data:{
      labels:RAW.ga4_monthly.map(m=>m.month),
      datasets:[
        {type:'bar',label:'Sesiones',data:RAW.ga4_monthly.map(m=>m.sessions),
         backgroundColor:'rgba(59,130,246,.7)',yAxisID:'y'},
        {type:'line',label:'Conversiones',data:RAW.ga4_monthly.map(m=>m.conv),
         borderColor:'#10B981',fill:false,tension:.3,yAxisID:'y1',pointRadius:5}
      ]
    },
    options:{
      responsive:true,maintainAspectRatio:false,
      plugins:{legend:legendStyle},
      scales:{
        x:{grid:gridStyle,ticks:tickStyle},
        y:{grid:gridStyle,ticks:tickStyle},
        y1:{position:'right',grid:{drawOnChartArea:false},ticks:tickStyle}
      }
    }
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TABLE SORTING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const sortState={};
function sortTable(tableId,col){
  const table=document.getElementById(tableId);
  const tbody=table.querySelector('tbody');
  const rows=Array.from(tbody.querySelectorAll('tr'));
  const key=tableId+'_'+col;
  sortState[key]=!sortState[key];
  const asc=sortState[key];
  
  // Update header arrows
  table.querySelectorAll('th').forEach((th,i)=>{
    th.classList.remove('sorted');
    const arr=th.querySelector('.sort-arrow');
    if(arr) arr.textContent='‚Üï';
  });
  const th=table.querySelectorAll('th')[col];
  if(th){
    th.classList.add('sorted');
    const arr=th.querySelector('.sort-arrow');
    if(arr) arr.textContent=asc?'‚Üë':'‚Üì';
  }
  
  rows.sort((a,b)=>{
    const av=a.cells[col]?.textContent.replace(/[$.,\s]/g,'')||'0';
    const bv=b.cells[col]?.textContent.replace(/[$.,\s]/g,'')||'0';
    const an=parseFloat(av.replace(/[^0-9.-]/g,'')),
          bn=parseFloat(bv.replace(/[^0-9.-]/g,''));
    if(!isNaN(an)&&!isNaN(bn)) return asc?an-bn:bn-an;
    return asc?av.localeCompare(bv):bv.localeCompare(av);
  });
  rows.forEach(r=>tbody.appendChild(r));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CSV EXPORT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function exportCSV(tableId,filename){
  const table=document.getElementById(tableId);
  const rows=Array.from(table.querySelectorAll('tr'));
  const csv=rows.map(r=>
    Array.from(r.querySelectorAll('th,td')).map(c=>
      '"'+c.textContent.replace(/"/g,'""')+'"').join(',')
  ).join('\n');
  const blob=new Blob(['\ufeff'+csv],{type:'text/csv;charset=utf-8'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;a.download=filename;a.click();
  URL.revokeObjectURL(url);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showSection(name,navEl){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.getElementById('section-'+name).classList.add('active');
  if(navEl) navEl.classList.add('active');
  
  // Initialize section data
  if(name==='overview') updateOverview();
  else if(name==='meta') updateMeta();
  else if(name==='anuncios') updateAnuncios();
  else if(name==='shopify') updateShopify();
  else if(name==='analytics') updateAnalytics();
  
  // Close mobile sidebar
  if(window.innerWidth<=768){
    document.getElementById('sidebar').classList.remove('mobile-open');
    document.getElementById('overlay').style.display='none';
  }
}

function showSubtab(tab,el){
  document.querySelectorAll('.subtab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('panel-ads').style.display=tab==='ads'?'block':'none';
  document.getElementById('panel-adsets').style.display=tab==='adsets'?'block':'none';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SIDEBAR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleSidebar(){
  const sb=document.getElementById('sidebar');
  sb.classList.toggle('collapsed');
}
function toggleMobile(){
  const sb=document.getElementById('sidebar');
  const ov=document.getElementById('overlay');
  sb.classList.toggle('mobile-open');
  ov.style.display=sb.classList.contains('mobile-open')?'block':'none';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.addEventListener('DOMContentLoaded',function(){
  initDatePicker();
  updateOverview();
  // Pre-build static tables
  updateMeta();
  updateAnuncios();
  buildOrdersTable();
  updateAnalytics();
  // Return to overview display
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById('section-overview').classList.add('active');
});
</script>
</body>
</html>